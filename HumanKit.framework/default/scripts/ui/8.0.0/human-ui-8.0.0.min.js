!function(a){"use strict";a.module("humanUI",["humanUI.config","humanUI.utilities","humanUI.tree","humanUI.load","humanUI.camera","humanUI.timeline","humanUI.crossSection","humanUI.annotations","humanUI.dissect","humanUI.modes","humanUI.info","humanUI.media","humanUI.scene","humanUI.bookmark","humanUI.fullscreen","humanUI.templates"]).constant("MIN_HUMAN_VERSION","8.0.0").run(["$rootScope","Human",function(a,b){b.properties.subscribe({propId:"locale",callback:function(b){a.$broadcast("human.locale",b)}}),a.uiComponents={config:{}}}]).factory("Human",["$window","MIN_HUMAN_VERSION",function(b,c){var d,e,f,g=[];a.forEach([Human.VERSION,c],function(a){a.replace(/^(\d+)\.(\d+)\.(\d+)-?(\w+)?$/,function(a,b,c,d,e){g.push({major:b,minor:c,patch:d,client:e||null})})});var h=["Human",Human.VERSION,"is not reliably supported! Use",c,"or higher."].join(" "),i=function(a){0!==a.length&&(f=a.shift(),d=g[0][f],e=g[1][f],e>d?b.console.warn(h):d===e&&i(a))};return 2===g.length?i(["major","minor","patch"]):b.console.warn(h),Human}]).factory("humanLoaded",["$q","Human",function(a,b){var c=a.defer();return b.events.on("loaded",function(){c.resolve()}),c.promise}]),a.module("humanUI.utilities",[]).factory("isBaseAnatomy",function(){return function(b){var c=a.isObject(b)?b.moduleId:b;return c?Human.modules.isBaseModule(c):!1}}).factory("touchTarget",["$document",function(a){return function(b,c){b.addEventListener("touchmove",function(b){var d=b.changedTouches[0],e=a[0].elementFromPoint(d.pageX,d.pageY);c(e)})}}]).factory("destroyInterval",["$interval",function(b){return function(c){a.isDefined(c)&&(b.cancel(c),c=void 0)}}]).factory("checkModule",function(){return function(b){try{a.module(b)}catch(c){return!1}return!0}}).factory("ElementDisplay",["OutsideListen",function(a){return{create:function(b){if(b.trigger&&b.target){var c,d=b.action||"toggle",e=d[0].toUpperCase()+d.slice(1),f=b.eventName||"element"+e,g="show"===d?"removeClass":"hide"===d?"addClass":"toggleClass";b.globalClose&&(c=a.create(b.target),c.excludedEls=[b.trigger[0],b.target[0]]);var h=function(a){b.target[a]("ng-hide");var d=!b.target.hasClass("ng-hide");c&&(d?c.add(h.bind(null,"addClass")):c.remove()),b.trigger.triggerHandler(f,d),b.target.triggerHandler(f,d)};b.trigger.on("click",h.bind(null,g))}}}}]).factory("OutsideListen",["$document",function(b){var c=function(c,d){d=d||{},this.element=c,this.excludedEls=[this.element[0]],a.isArray(d.exclude)&&a.forEach(d.exclude,function(a){var c=b[0].querySelectorAll(a);c=Array.prototype.slice.call(c),this.excludedEls=this.excludedEls.concat(c)},this)};return c.prototype._checkContainment=function(a){for(var b=0;b<this.excludedEls.length;b++)if(this.excludedEls[b].contains(a))return!0;return!1},c.prototype.add=function(a){var c=function(b){this._checkContainment(b.target)||(a(),this.remove())};this.checkOutside=c.bind(this),b[0].addEventListener("touchstart",this.checkOutside,!0),b[0].addEventListener("mousedown",this.checkOutside,!0)},c.prototype.remove=function(){b[0].removeEventListener("touchstart",this.checkOutside,!0),b[0].removeEventListener("mousedown",this.checkOutside,!0),this.checkOutside=null},{create:function(a,b){return new c(a,b)}}}]).filter("parseActions",["$sce","Human",function(b,c){return function(d){return a.isString(d)?b.trustAsHtml(c.actions.parse(d)):""}}]).filter("translate",function(){return function(a,b,c){var d=a[b];return c&&a.translations&&a.translations[c]&&(d=a.translations[c][b]||d),d}}).filter("excludeBaseAnatomy",["isBaseAnatomy",function(a){return function(b){return a(b)?null:b}}]).directive("toggleButton",function(){return{restrict:"A",scope:{config:"=toggleButton"},link:function(b,c,d){var e,f="on"===d.toggleDefault,g=function(b){a.isDefined(b)&&(f=!!b,c[f?"addClass":"removeClass"]("on"))};f&&c.addClass("on"),c.on("click",function(){f=!f,e=f?"on":"off",a.isFunction(b.config[e])&&b.config[e](),b.$apply()}),b.$watch("config.model",function(a,b){a!==b&&g(a)})}}}),a.module("humanUI.utilities").factory("Draggable",["$window","$document",function(b,c){var d,e,f,g,h,i="touchstart mousedown",j="touchmove mousemove",k="touchend touchcancel mouseup",l=[],m=function(c,d){var e={element:b,axis:!1,elementBounds:!1};if(a.isString(c.element)){var f=c.element.split(".");"parent"===f[0]&&(e.element=d.parent()[0]),("width"===f[1]||"height"===f[1])&&(e.elementBounds=f[1])}else"boolean"==typeof c.element&&(c.element||(e.element=!1));return("x"===c.axis||"y"===c.axis)&&(e.axis=c.axis),e},n=function(b){this.element=b.element,this.handle=b.handle||b.element,this.constraints=m(b.constraints||{},this.element),this.callbacks={onStart:b.onStart||a.noop,onMove:b.onMove||a.noop,onEnd:b.onEnd||a.noop},a.forEach(i.split(" "),function(a){this.handle.on(a+".draggable",this.onStart.bind(this))},this)};return n.prototype.setElCoords=function(){this.width=this.element[0].offsetWidth,this.height=this.element[0].offsetHeight,f=b.parseInt(this.element.css("margin-left")),g=b.parseInt(this.element.css("margin-top")),this.x=this.element[0].offsetLeft-f,this.y=this.element[0].offsetTop-g,this.parentX=this.element[0].offsetParent.offsetLeft,this.parentY=this.element[0].offsetParent.offsetTop},n.prototype.setEventCoords=function(a){a=a.originalEvent||a,a=a.changedTouches?a.changedTouches[0]:a,this.deltaX=a.clientX-this.eventX||0,this.deltaY=a.clientY-this.eventY||0,this.eventX=a.clientX,this.eventY=a.clientY},n.prototype.constrainX=function(a){return this.constraints.element&&(this.constraints.element===b?(d=0-this.parentX,e=b.innerWidth-this.parentX):(d=0,e=this.constraints.element.offsetWidth),d>a&&(a=d),h="width"===this.constraints.elementBounds?0:this.width,a+h>e&&(a=e-h)),"y"===this.constraints.axis&&(a=this.x),a},n.prototype.constrainY=function(a){return this.constraints.element&&(this.constraints.element===b?(d=0-this.parentY,e=b.innerHeight-this.parentY):(d=0,e=this.constraints.element.offsetHeight),d>a&&(a=d),h="height"===this.constraints.elementBounds?0:this.height,a+h>e&&(a=e-h)),"x"===this.constraints.axis&&(a=this.y),a},n.prototype.onStart=function(b){b.stopPropagation(),b.preventDefault(),this.setElCoords(),this.setEventCoords(b),a.forEach(j.split(" "),function(a){c.on(a+".draggable",this.onMove.bind(this))},this),a.forEach(k.split(" "),function(a){c.on(a+".draggable",this.onEnd.bind(this))},this),this.callbacks.onStart(this.x,this.y)},n.prototype.onMove=function(a){a.stopPropagation(),a.preventDefault(),this.setEventCoords(a),this.x=this.constrainX(this.x+this.deltaX),this.y=this.constrainY(this.y+this.deltaY),this.element.css({left:this.x+"px",top:this.y+"px"}),this.callbacks.onMove(this.x,this.y)},n.prototype.onEnd=function(){a.forEach(j.split(" "),function(a){c.off(a+".draggable")},this),a.forEach(k.split(" "),function(a){c.off(a+".draggable")},this),this.callbacks.onEnd()},{create:function(a){var b=new n(a);l.push(b)}}}]).directive("draggable",["Draggable",function(a){return{restrict:"A",link:function(b,c,d){var e,f,g=c.find("drag-handle");e="false"===d.constrainElement?!1:/^parent/.test(d.constrainElement)?d.constrainElement:"window",("x"===d.constrainAxis||"y"===d.constrainAxis)&&(f=d.constrainAxis),a.create({element:c,handle:g.length?g:c,constraints:{element:e,axis:f}})}}}]),a.module("humanUI.utilities").directive("humanSlider",["Draggable",function(b){return{restrict:"E",scope:{config:"="},templateUrl:"templates/utilities/slider.html",link:function(c,d){var e,f,g=0,h={min:0,max:1,range:1},i=d.children(),j=i.children(),k=j.eq(0),l=j.eq(1),m=i[0],n=function(){f=100*e+"%",l.css("left",f),k.css("width",f),c.config.label&&(c.label=c.config.label())},o=function(b,c){a.isNumber(c)&&(h[b]=c,h.range=h.max-h.min)},p=function(a){e=a/m.offsetWidth,c.config.value=e*h.range+h.min,c.config.change&&c.config.change({x:a,fraction:e}),c.$apply()};i.on("mousedown",function(a){g=a.clientX-a.target.getBoundingClientRect().left,p(g)}),b.create({element:l,constraints:{element:"parent.width",axis:"x"},onMove:p}),c.$watch("config.min",function(a){o("min",a)}),c.$watch("config.max",function(a){o("max",a)}),c.$watch("config.value",function(b){a.isNumber(b)&&(e=(b-h.min)/h.range,g=e*m.offsetWidth,n())})}}}]),a.module("humanUI.annotations",[]).directive("humanAnnotations",["Human",function(a){return{restrict:"E",scope:!0,templateUrl:"templates/annotations/panel.html",link:function(b){var c=a.view.annotations;b.info="Toggle Annotations",b.toggleAnnotations={on:c.setShown.bind(c,!0),off:c.setShown.bind(c,!1)},a.events.on("annotations.shown",function(a){b.toggleAnnotations.model=a.shown,b.$apply()}),a.events.on("timeline.chapters.activated",function(){b.toggleAnnotations.model=c.shown,b.$apply()}),b.$watch("uiComponents.config.annotations",function(a){b.show=!!a})}}}]),a.module("humanUI.bookmark",[]).constant("THUMBNAIL_URL","thumbnails/bookmarks?eid").filter("BookmarkTour",["THUMBNAIL_URL",function(b){return function(c){var d=c.tour;return delete c.tour,d.unshift(c),a.forEach(d,function(a){a.tourMember=!0,a.thumbnailSrc=[b,a.eid].join("=")}),d}}]).constant("BOOKMARK_TOUR_BASE_STATE",{isTour:!1,isTourMember:!1,restoring:!1,captures:[],curCapture:null,curCaptureIndex:null}).provider("BookmarkTour",["BOOKMARK_TOUR_BASE_STATE",function(b){var c={compare:!1},d=a.extend({},b),e={newModules:null,oldModules:null},f=function(f,g,h,i,j){var k,l,m,n={},o=function(b){a.forEach(b,function(a){j.modules.isBaseModule(a)&&(l=a.split("/"),m=l[l.length-1].replace(/\.json$/,""),n[m]||j.assets.server.cacheStateIndex(m))})},p=function(b){k=[],a.forEach(b,function(b){o(b.modules.activeModules),k.push(a.copy(b.modules.activeModules))})},q=function(a){d.curCapture=d.captures[a]||null,d.curCaptureIndex=d.curCapture?a:null},r=function(){var b=Object.keys(j.modules.activeModules);a.forEach(b,function(a){j.modules.isBaseModule(a)?j.modules.deactivateModules({moduleId:a}):j.modules.destroyModules({moduleId:a})})},s=function(){a.equals(e.oldModules,e.newModules)||j.modules.deactivateModules()},t=function(a){e.oldModules=e.newModules,e.newModules=k[a],c.compare?s():r()};return d.reset=function(){a.extend(d,b)},d.restore=function(b,c){var e=d.captures[b];e&&(d.restoring=!0,q(b),h(function(){t(b),j.bookmarks.restore(e,function(){a.isFunction(c)&&c()})}))},d.onRestored=function(){d.isTour||d.isTourMember||(d.captures=[])},j.events.on("bookmarks.restored",function(b){d.restoring=!1,d.isTour=!(!b.tour||!b.tour.length),d.isTourMember=!!b.tourMember,d.isTour&&(d.captures=g("BookmarkTour")(b),p(d.captures),q(0));var c=a.isArray(d.captures)&&!!d.captures.length;d.bookmarkTour=(d.isTour||d.isTourMember)&&c,d.onRestored(b),f.$broadcast("bookmarkTour.state",d)}),{state:d}};return f.$inject=["$rootScope","$filter","$timeout","$q","Human"],{$get:f,config:function(b){a.extend(c,b)},extend:function(b){a.extend(d,b)}}}]).directive("updateScroll",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){var e,f,g,h,i=d.updateScroll,j=function(b){a(function(){e=c[0].offsetWidth,f=c[0].scrollWidth,f>e&&(g=f/c.children().length,h=f-e,c[0].scrollLeft=g*(b+1)-h)})};b.$watch(i,j)}}}]).directive("prevNextBookmark",["Human","BookmarkTour",function(a,b){return{restrict:"A",link:function(a,c,d){var e,f="next"===d.prevNextBookmark?1:-1;a.state=b.state,c.on("click",function(){e||b.state.restore(a.state.curCaptureIndex+f)});var g={expressions:["state.curCaptureIndex","state.captures.length"],callback:function(a){e=!!(1===f&&a[0]===a[1]-1||-1===f&&0===a[0]),c[e?"addClass":"removeClass"]("disabled")}};a.$watchGroup(g.expressions,g.callback)}}}]).directive("humanBookmarkTour",["$timeout","$document","Human","BookmarkTour",function(a,b,c,d){return{restrict:"E",templateUrl:"templates/bookmark/tour.html",scope:!0,link:function(a){a.show=!1;var b,c,e=function(){a.show=b&&c};a.restore=function(a){d.state.restore(a)},a.reset=function(){d.state.reset()},a.$on("bookmarkTour.state",function(a,b){c=b.bookmarkTour,e()}),a.$watch("uiComponents.config.bookmarkTour",function(a){b=!!a,e()})}}}]),a.module("humanUI.camera",[]).factory("getPanRate",["Human",function(a){var b=new Float64Array(3),c=new Float64Array(3),d=new Float64Array(3),e=function(a,b){b[0]=a.x,b[1]=a.y,b[2]=a.z};return function(){return e(a.view.camera.getEye(),b),e(a.view.camera.getLook(),c),d=a.math.subVec3(b,c,d),.12*a.math.lenVec3(d)}}]).directive("centerCamera",["Human",function(a){return{restrict:"A",link:function(b,c){c.on("click",function(){a.init.resetCamera()})}}}]).directive("humanCameraCenter",function(){return{restrict:"E",scope:!0,templateUrl:"templates/camera/center.html",link:function(a){a.$watch("uiComponents.config.center",function(b){a.show=!!b})}}}).directive("panCamera",["$interval","Human","getPanRate","touchTarget","destroyInterval",function(b,c,d,e,f){var g={interval:10},h="touchstart mousedown",i="touchend touchcancel mouseleave mouseup";return{restrict:"A",link:function(j,k,l){var m,n,o,p,q,r=l.panCamera||"up",s=function(){p=g.interval/1e3*d(),q=b(function(){switch(m=0,n=0,o=0,r){case"up":n=-p;break;case"down":n=p;break;case"left":m=-p;break;case"right":m=p}c.view.camera.pan({x:m,y:n,z:o})},g.interval)};e(k[0],function(a){k[0]!==a&&f(q)}),a.forEach(h.split(" "),function(a){k.on(a,function(a){a.preventDefault(),s()})}),a.forEach(i.split(" "),function(a){k.on(a,function(){f(q)})})}}}]).directive("humanCameraPan",function(){var a={up:"W",down:"S",left:"D",right:"A"};return{restrict:"E",scope:!0,templateUrl:"templates/camera/pan.html",link:function(b){b.keys=a,b.$watch("uiComponents.config.pan",function(a){b.show=!!a})}}}).directive("zoomCamera",["$interval","Human","touchTarget","destroyInterval",function(b,c,d,e){var f={step:.05,interval:10},g="touchstart mousedown",h="touchend touchcancel mouseleave mouseup";return{restrict:"A",link:function(i,j,k){var l,m="out"===k.zoomCamera?1:-1;d(j[0],function(a){j[0]!==a&&e(l)}),a.forEach(g.split(" "),function(a){j.on(a,function(a){a.preventDefault(),l=b(function(){c.view.camera.zoom(f.step*m)},f.interval)})}),a.forEach(h.split(" "),function(a){j.on(a,function(){e(l)})})}}}]).directive("humanCameraZoomIn",function(){return{restrict:"E",scope:!0,templateUrl:"templates/camera/zoom-in.html",link:function(a){a.$watch("uiComponents.config.zoomIn",function(b){a.show=!!b})}}}).directive("humanCameraZoomOut",function(){return{restrict:"E",scope:!0,templateUrl:"templates/camera/zoom-out.html",link:function(a){a.$watch("uiComponents.config.zoomOut",function(b){a.show=!!b})}}}).directive("humanCameraZoom",function(){return{restrict:"E",scope:!0,templateUrl:"templates/camera/zoom.html",link:function(a){var b=["uiComponents.config.zoomOut","uiComponents.config.zoomIn"];a.$watchGroup(b,function(b){a.show=!!b[0]&&!!b[1]})}}}).directive("humanCameraMode",["$timeout","Human",function(a,b){return{restrict:"E",scope:!0,templateUrl:"templates/camera/mode.html",link:function(c,d){var e=b.properties,f="input.mouseOrbitPan",g={};c.cameraMode={on:function(){g[f]="orbit",e.set(g)},off:function(){g[f]="pan",e.set(g)}};var h=e.subscribe({propId:f,callback:function(b){a(function(){d.attr("mode",b),c.cameraMode.model="orbit"===b,c.mode=b,c.$apply()})}});e.resubscribe(h,f),c.$watch("uiComponents.config.cameraMode",function(a){c.show=!!a})}}}]),a.module("humanUI.config",[]).constant("BASE_CONFIG",{bookmarkTour:!1,annotations:!1,audio:!1,info:!1,loadProgress:!0,fullscreen:!0,pan:!0,zoomIn:!0,zoomOut:!0,center:!0,cameraMode:!0,objectTree:!1,playPause:!1,scrubber:!1,tour:!1,crossSection:!1,dissect:!1,isolate:!1,xray:!1}).constant("CONFIG_GROUPS",{nav:["pan","zoomIn","zoomOut","center","cameraMode"],zoom:["zoomIn","zoomOut"],scene:["objectTree"],tools:["crossSection","dissect","isolate","xray"],modes:["isolate","xray"]}).constant("CONFIG_ALIASES",{loader:"loadProgress",panel:"info",tree:"objectTree",fs:"fullscreen"}).constant("EXPANDABLE_UI_COMPONENTS",{components:{scrubber:{chapters:!1,tour:!1},tour:{chapters:!1},playPause:{tour:!1}},notes:{"scrubber.chapters":"Display chapters for scrubber","scrubber.tour":"Play one chapter at a time","tour.chapters":"Display chapters for tours","playPause.tour":"Play one chapter at a time"}}).filter("convertTags",function(){return function(b,c){return a.isArray(c)&&c.length>0&&(c.has=function(a){return this.indexOf(a)>-1},c.has("scrubber")||c.has("scrubber-chapters")?(b.scrubber=!0,c.has("scrubber-chapters")&&(b.scrubber={chapters:!0},c.has("tour")&&(b.scrubber.tour=!0))):(c.has("play-controls")&&(b.playPause=!0),c.has("tour")&&(b.tour=!0)),delete c.has),b}}).filter("extendConfig",["CONFIG_ALIASES","CONFIG_GROUPS",function(b,c){return function(d,e){return e.hasOwnProperty("all")?a.forEach(d,function(a,b){d[b]=e.all}):(a.forEach(c,function(b,c){e.hasOwnProperty(c)&&a.forEach(b,function(a){d[a]=e[c]})}),a.extend(d,e),a.forEach(c,function(a,b){d.hasOwnProperty(b)&&delete d[b]}),a.forEach(b,function(a,b){d.hasOwnProperty(b)&&(d[a]=d[b],delete d[b])})),d}}]).filter("uiParams",["CONFIG_ALIASES",function(b){var c,d,e=/^ui-/,f=function(a){return"true"===a?!0:"false"===a||""===a?!1:a};return function(g){var h,i={};return a.forEach(g,function(a,g){(e.test(g)||b.hasOwnProperty(g))&&(d=g.replace(e,"").replace(/-([a-z])/g,function(a){return a[1].toUpperCase()}).split("."),a=f(a),d.length>1?(c=d.shift(),i[c]=i[c]||{},h=i[c]):h=i,h[d.shift()]=a)}),i}}]).provider("ConfigCreator",function(){var b={},c=!1,d=function(d,e,f,g,h,i){return{urlConfig:i(f.request.getSearchParams()),bookmarkConfig:{},contentConfig:{},init:function(){var a=this;f.events.on("modules.activating",function(b){var c=f.modules.modules[b.moduleId];a._buildContentConfig(c),a._extend(),d.$apply()});var b=!1;d.$on("bookmarkTour.state",function(c,e){e.bookmarkTour!==b&&(b=e.bookmarkTour,a.bookmarkConfig.bookmarkTour=e.bookmarkTour,a._extend(),d.$apply())})},_buildContentConfig:function(a){var b=h({},a.tags);g(b,a.ui||{}),this.contentConfig=b},_extend:function(){var f=a.extend({},e),h=[this.contentConfig,this.bookmarkConfig];h[c?"push":"unshift"](b);for(var i=0;i<h.length;i++)g(f,h[i]);g(f,this.urlConfig),d.uiComponents.config=f}}};return d.$inject=["$rootScope","BASE_CONFIG","Human","extendConfigFilter","convertTagsFilter","uiParamsFilter"],{$get:d,extendBase:function(a,d){b=a,c=!!d}}}).run(["ConfigCreator",function(a){a.init()}]),a.module("humanUI.crossSection",[]).factory("Clip",["Human",function(b){return{MAP:[{view:"Anterior",clip:b.view.clip.FRONT},{view:"Posterior",clip:b.view.clip.BACK},{view:"Left",clip:b.view.clip.LEFT},{view:"Right",clip:b.view.clip.RIGHT},{view:"Superior",clip:b.view.clip.TOP},{view:"Inferior",clip:b.view.clip.BOTTOM}],state:{current:null},show:function(a){b.view.clip.setClip({state:"clipping"}),b.view.clip.selectClip(a),b.view.clip.setClip({state:"visible"})},reset:function(){a.forEach(b.view.clip.clips,function(a){a.progress=0}),b.view.clip.reset(),this.state.current=this.MAP[0],this.show(this.state.current.clip)}}}]).directive("humanCameraClip",["Human",function(a){var b=a.math.vec3(),c=a.math.vec3(),d=a.math.vec3(),e=a.view.camera,f=e.near,g=function(){return b[0]=e.eye.x,b[1]=e.eye.y,b[2]=e.eye.z,c[0]=e.look.x,c[1]=e.look.y,c[2]=e.look.z,a.math.subVec3(b,c,d),Math.abs(a.math.lenVec3(d))},h=function(){a.properties.set({"camera.optics.near":.75*g()})};return{restrict:"E",scope:!0,templateUrl:"templates/cross-section/camera-clip.html",link:function(b){var c=function(a){b.toggleCameraClip.model=a,b.$apply()};b.toggleCameraClip={on:function(){a.events.on("camera.updated",h),h(),c(!0)},off:function(){a.events.off("camera.updated",h),a.properties.set({"camera.optics.near":f}),c(!1)}}}}}]).directive("cycleSectionPlane",["Clip",function(a){return{restrict:"A",link:function(b,c){c.on("click",function(){var c=a.state.current?a.MAP.indexOf(a.state.current):0;c=c===a.MAP.length-1?0:c+1,a.state.current=a.MAP[c],a.show(a.state.current.clip),b.$apply()})}}}]).directive("resetSectionPlane",["Clip",function(a){return{restrict:"A",link:function(b,c){c.on("click",function(){a.reset(),b.$apply()})}}}]).directive("humanCrossSectionSlider",["Human",function(a){return{restrict:"E",scope:!0,templateUrl:"templates/cross-section/slider.html",link:function(b){b.config={value:0,change:function(b){a.view.clip.setClip({state:"visible",progress:b.fraction}),0===b.fraction&&a.view.clip.selectedClip._setProgress(0)}},a.events.on("clip.updated",function(a){b.config.value=a.progress||0,b.$apply()})}}}]).directive("humanCrossSection",["$parse","$timeout","Clip",function(b,c,d){return{restrict:"E",scope:!0,templateUrl:"templates/cross-section/controls.html",link:function(e,f,g){var h=function(a){c(function(){Human.view.clip.setClip({clipId:d.state.current.clipId,state:a?"visible":"clipping"})})};d.state.current=d.MAP[0],e.state=d.state,e.tooltipText={select:"Select Plane",reset:"Reset"},g.tooltipText&&a.extend(e.tooltipText,b(g.tooltipText)({})),f.on("crossSectionToggle",function(a,b){h(b)})}}}]).directive("humanCrossSectionToggle",["$document","Clip","ElementDisplay",function(b,c,d){return{restrict:"E",scope:!0,templateUrl:"templates/cross-section/toggle.html",link:function(c,e,f){var g;g=f.hasOwnProperty("target")?a.element(b[0].querySelector(f.target)):e.next(),d.create({trigger:e,target:g,eventName:"crossSectionToggle",globalClose:f.hasOwnProperty("globalClose")}),e.on("crossSectionToggle",function(a,b){c.callbacks.model=b,c.$apply()}),c.info="Cross Section",c.callbacks={on:a.noop,off:a.noop},c.$watch("uiComponents.config.crossSection",function(a){c.show=!!a})}}}]),a.module("humanUI.dissect",[]).directive("undoDissect",["Human",function(a){return{restrict:"A",scope:!0,link:function(b,c){var d=!0;c.addClass("disabled"),c.on("click",function(){d||a.view.dissect.undo()}),a.events.on("dissect.toggled",function(a){d=!a.enabled,c[d?"addClass":"removeClass"]("disabled")})}}}]).directive("humanDissectUndo",function(){return{restrict:"E",scope:!0,templateUrl:"templates/dissect/undo.html",link:function(a){a.info="Undo Dissect [Ctrl + Z]",a.$watch("uiComponents.config.dissect",function(b){a.show=!!b})}}}).directive("humanDissect",["$parse","Human",function(a,b){return{restrict:"E",scope:!0,templateUrl:"templates/dissect/dissect.html",link:function(a){var c=function(a){b.rpc.call(null,"dissect.setEnabled",{enabled:a})};a.info="Dissect [Ctrl + X]",a.toggleDissect={on:c.bind(null,!0),off:c.bind(null,!1)},b.events.on("dissect.toggled",function(b){a.toggleDissect.model=b.enabled,a.$apply()}),a.$watch("uiComponents.config.dissect",function(b){a.show=!!b})}}}]),a.module("humanUI.fullscreen",[]).factory("Fullscreen",["$document","$rootScope",function(b,c){var d,e=b[0],f=e.body,g={request:[f.requestFullscreen,f.webkitRequestFullscreen,f.mozRequestFullScreen,f.msRequestFullscreen],exit:[e.exitFullscreen,e.webkitExitFullscreen,e.mozCancelFullScreen,e.msExitFullscreen]};return{VENDOR_PREFIXES:["","webkit","moz","ms"],setMethods:function(){var b,c={};for(var d in g)if(g.hasOwnProperty(d)){b=g[d];for(var h=0;h<b.length;h++)if(a.isFunction(b[h])){c[d]=b[h];break}if(!c[d])return!1}return this.request=c.request.bind(f),this.exit=c.exit.bind(e),!0},isActive:function(){return d=e.fullscreenElement||e.webkitFullscreenElement||e.mozFullScreenElement||e.msFullscreenElement||void 0,!!d},bindHandlers:function(){var d,f=this;b.on("keypress",function(a){var b=a.target.nodeName.toLowerCase();"input"!==b&&"textarea"!==b&&70===a.which&&a.shiftKey&&f.toggle()}),a.forEach(this.VENDOR_PREFIXES,function(a){var b=a+"fullscreenchange";e.addEventListener(b,function(){d=f.isActive(),c.$broadcast("fullscreen.change",{active:d,fromUI:f._fromUI}),f._fromUI=!1},!1)})},_fromUI:!1,toggle:function(){this._fromUI=!0,this[this.isActive()?"exit":"request"]()}}}]).directive("humanFullscreen",["$window","Fullscreen",function(a,b){var c=a===a.top;return{restrict:"E",scope:!0,templateUrl:"templates/fullscreen/panel.html",link:function(a){a.toggleFullscreen={on:b.toggle.bind(b),off:b.toggle.bind(b)},a.$on("fullscreen.change",function(b,c){a.toggleFullscreen.model=c.active,a.mode=c.active?"fullscreen":"normalscreen",a.$digest()}),a.$watch("uiComponents.config.fullscreen",function(b){a.show=c&&!!b})}}}]).directive("windowLink",["$window",function(a){return{restrict:"A",link:function(b,c){c.attr("href",a.location.href)}}}]).directive("humanWindowLink",["$window",function(a){var b=a===a.top;return{restrict:"E",scope:!0,templateUrl:"templates/fullscreen/window-link.html",link:function(a){a.$watch("uiComponents.config.fullscreen",function(c){a.show=!b&&!!c})}}}]).run(["Fullscreen",function(a){var b=a.setMethods();b&&a.bindHandlers()}]),a.module("humanUI.info",[]).run(["Info",function(a){a._instantiated=!0}]).provider("Info",function(){var b={baseAnatomy:!1,modifyLinks:!0,props:["title","displayName","description"],precedence:["bookmark","chapter","module"]},c={info:{bookmark:null,chapter:null,module:null},current:null,precedence:a.copy(b.precedence)},d=function(d,e){var f=function(){for(var d,e=0;e<b.precedence.length;e++)if(d=c.info[b.precedence[e]],a.isObject(d)&&(d.title||d.description))return void(c.current=b.precedence[e]);c.current=null},g=function(d){b.precedence=a.copy(d),c.precedence=d,f()},h=function(a,e){if(!c.info.hasOwnProperty(a)||!e)return null;var g={};for(var h in e)if(e.hasOwnProperty(h)&&b.props.indexOf(h)>=0){var i=e[h];"displayName"===h&&(h="title"),b.modifyLinks&&(i=d("modifyLinks")(i)),g[h]=i}c.info[a]=g,f()},i=function(){for(var a in c.info)c.info.hasOwnProperty(a)&&(c.info[a]=null)};return e.events.on("bookmarks.restored",function(a){h("bookmark",a)}),e.events.on("timeline.chapters.activated",function(a){var b=e.timeline.chapterList[a.newChapterIndex];h("chapter",b)}),e.events.on("modules.activated",function(a){var c=e.modules.activeModules[a.moduleId];b.baseAnatomy||(c=d("excludeBaseAnatomy")(c)),h("module",c)}),e.events.on("modules.deactivated",i),{state:c,setPrecedence:g,setInfo:h}};return d.$inject=["$filter","Human"],{$get:d,config:function(c){a.extend(b,c)}}}).filter("modifyLinks",["$document",function(b){var c=b[0];return function(b){var d=c.createElement("div");d.innerHTML=b;var e=d.querySelectorAll("a");return a.forEach(e,function(a){/^(http)|(\/\/)/.test(a.href)&&a.setAttribute("target","_blank")}),d.innerHTML}}]).directive("humanInfo",["$filter","Info",function(b,c){return{restrict:"A",scope:!0,link:function(d){var e=function(){var e=c.state.current;if(e){var f=a.copy(c.state.info[e]);f.description&&(f.description=b("parseActions")(f.description)),d.info=f}else d.info=null};d.state=c.state,d.info=null,d.show=!1,d.$watch("state.current",e),d.$watchCollection("state.info",e),d.$watch("info",function(a){d.show=!!a})}}}]),a.module("humanUI.load",[]).directive("humanLoadProgress",["Human","$timeout",function(b,c){var d="geometry material transform morph";return{restrict:"E",scope:!0,templateUrl:"templates/load/progress.html",link:function(e,f,g){var h,i=g.showAssetTypes||d;e.statusText="Loading...",e.progressPercent="0%",b.events.on("modules.activating",function(a){var c=b.modules.modules[a.moduleId];e.statusText="Loading "+c.displayName+"..."}),b.events.on("assets.load.start",function(){e.show=h,e.$digest()}),b.events.on("assets.load.progress",function(a){var b=a.receivedAssets/a.requestedAssets;e.curAssetType=a.assetType,e.progressPercent=Math.floor(100*b)+"%",e.show=h&&i.indexOf(a.assetType)>=0,f[0].style.width=e.progressPercent,e.$digest()}),b.events.on("assets.load.finish",function(){c(function(){e.progressPercent="0%",e.statusText="",e.show=!1,e.$digest()})}),e.$watch("uiComponents.config.loadProgress",function(b){a.isString(b)&&!f.hasClass(b)&&f.addClass(b),h=!!b})}}}]),a.module("humanUI.media",[]).constant("AUDIO_TYPES",{ogg:'audio/ogg;codecs="vorbis"',mp3:"audio/mpeg;"}).constant("AUDIO_PATH","/content/states/{{ modelId }}/audio/sounds/{{ src }}").factory("Media",["$document","$interpolate","AUDIO_TYPES","AUDIO_PATH",function(a,b,c,d){var e={},f={};return{supportTest:function(b){if(e.hasOwnProperty(b))return e[b];if(!b&&e.hasOwnProperty("audio"))return e.audio;var d=a[0].createElement("audio"),f=!!d.canPlayType;return b?(f=f&&!!d.canPlayType(c[b]||b),e[b]=f):e.audio=f,f},getSupportedSrc:function(a){if(f[a.clipId])return f[a.clipId];var c={modelId:a.modelId,src:a.src},e=b(d)(c),g=a.src.match(/\.(\w+)$/);g=g&&g[1];for(var h=[g].concat(a.alternatives||[]),i=0;i<h.length;i++)if(this.supportTest(h[i]))return f[a.clipId]=e.replace(/\.\w+$/,"."+h[i]),f[a.clipId];return!1}}}]).directive("muteReplayAudio",function(){return{restrict:"A",scope:!0,link:function(b,c){c.on("click",function(){b[b.states.ended?"replay":"toggleMute"](),b.$apply()}),b.$watch("states",function(b){a.forEach(["ended","muted"],function(a){c[b[a]?"addClass":"removeClass"](a)})},!0)}}}).directive("humanAudio",["$q","Human","Media",function(a,b,c){return{restrict:"E",scope:!0,templateUrl:"templates/media/audio.html",link:function(a,d){var e,f,g,h,i=d.find("audio")[0],j=function(){a.show=!!g&&!!h};a.states={ended:!1,muted:!1},a.replay=function(){i.currentTime=0,i.play(),a.states.ended=!1},a.toggleMute=function(){i.muted=!i.muted,a.states.muted=i.muted},i.addEventListener("ended",function(){a.states.ended=!0,a.$apply()}),i.addEventListener("playing",function(){a.states.ended=!1,a.$apply()}),b.events.on("audio.clips",function(){e=b.media.audio.clips}),b.events.on("audio.suggestedClips",function(b){0!==b.length&&e?(h=!0,g&&(f=e[b[0]],i.src=c.getSupportedSrc(f))):h=!1,j(),a.$apply()}),a.$watch("uiComponents.config.audio",function(a){g=!!a,j()})}}}]),a.module("humanUI.modes",[]).directive("humanXray",["Human",function(a){return{restrict:"E",scope:!0,templateUrl:"templates/modes/xray.html",link:function(b){b.info="X-Ray Mode [T]",b.toggleXray={on:a.view.setModeEnabled.bind(a.view,"xray"),off:a.view.setModeEnabled.bind(a.view,"highlight")},a.events.on("xray.toggled",function(a){b.toggleXray.model=a.enabled,b.$apply()}),b.$watch("uiComponents.config.xray",function(a){b.show=!!a})}}}]).directive("humanIsolate",["Human",function(a){return{restrict:"E",scope:!0,templateUrl:"templates/modes/isolate.html",link:function(b){b.info="Isolate Mode [I]",b.toggleIsolate={on:a.view.setModeEnabled.bind(a.view,"isolate"),off:a.view.setModeEnabled.bind(a.view,"highlight")},a.events.on("isolate.toggled",function(a){b.toggleIsolate.model=a.enabled,b.$apply()}),b.$watch("uiComponents.config.isolate",function(a){b.show=!!a})}}}]),a.module("humanUI.scene",[]).factory("ObjectTree",["ObjectTreeEnabled","ObjectTreeSelected","ObjectTreeRendered",function(b,c,d){return{getSceneObjects:function(b){var c=[];return a.forEach(b,function(a){c=c.concat(a.objects)}),c},init:function(a){d.init(),b.init(a),c.init(a)}}}]).factory("ObjectTreeRendered",["$timeout","Tree","Human",function(a,b,c){var d,e={},f=[],g=0,h=1,i=function(){for(var a=0;a<f.length;a++)f[a].addClass("anatomy-rendered");f.length=0},j=function(){h=Math.floor(g/100),1>h&&(h=1),h>20&&(h=20)},k=function(a){for(;a&&!e[a.objectId];)d=b.getLi(a.objectId),d&&(f.push(d),f.length===h&&i(),e[a.objectId]=!0),a=a.parent},l={onAssetLoadProgress:function(a){0===g&&(g=a.requestedAssets,j())},onObjectRenderable:function(b){a(function(){k(c.scene.objects[b.objectId])})},onAssetAttachFinish:function(){i(),e={},g=0},init:function(){c.events.off("assets.load.progress",this.onAssetLoadProgress),c.events.on("assets.load.progress",this.onAssetLoadProgress),c.events.off("scene.objectRenderable",this.onObjectRenderable),c.events.on("scene.objectRenderable",this.onObjectRenderable),c.events.off("graph.assetAttach.finish",this.onAssetAttachFinish),c.events.on("graph.assetAttach.finish",this.onAssetAttachFinish)}};return l}]).factory("ObjectTreeEnabled",["$timeout","Tree","Human",function(a,b,c){var d={onObjectsShown:function(c){var e=c.enabledObjectsUpdate;a(function(){b.updateState(e,d.update)})},update:function(a,c){var d=b.getLi(c);d&&d[a?"addClass":"removeClass"]("anatomy-enabled")},onObjectShow:function(a){if(a.target.hasAttribute("object-enabled")){a.stopPropagation();var c=a.target.getAttribute("object-enabled"),e=b.getLi(c);e.toggleClass("anatomy-enabled");var f=e.hasClass("anatomy-enabled");d.toggleEnabledAnatomy(f,c)}},toggleEnabledAnatomy:function(a,b){var d={};d[b]=a,
c.scene.setEnabledObjects({objects:d})},init:function(a){a.off("click.objectShow",this.onObjectShow),a.on("click.objectShow",this.onObjectShow),c.events.off("scene.objectsShown",this.onObjectsShown),c.events.on("scene.objectsShown",this.onObjectsShown)}};return d}]).provider("ObjectTreeSelected",function(){var b={selectOpen:!0,deselectClose:!0},c=function(a,c,d,e){var f={throttle:!1,onObjectsSelected:function(b){var c=b.selectedObjectsUpdate;a(function(){d.updateState(c,f.update)})},update:function(a,c){var g=d.getLi(c),h=e.getTarget(g);g&&(g[a?"addClass":"removeClass"]("anatomy-selected"),h&&(b.selectOpen&&a&&!f.throttle&&e.show(h,{animate:!1}),b.deselectClose&&!a&&e.hide(h,{animate:!1})))},onObjectSelect:function(a){if(a.target.hasAttribute("object-selected")){a.stopPropagation();var b=a.target.getAttribute("object-selected"),c=d.getLi(b);f.throttle=!0,f.selectAnatomy(b);var g=e.getTarget(c);g&&e.show(g)}},selectAnatomy:function(a){var b=c.view.pick.getMultiPickEnabled();c.view.focus.focusObject({objectId:a,replace:!b,flyTo:b?"none":"newSelected"},function(){f.throttle=!1})},init:function(a){a.off("click.objectSelect",this.onObjectSelect),a.on("click.objectSelect",this.onObjectSelect),c.events.off("scene.objectsSelected",this.onObjectsSelected),c.events.on("scene.objectsSelected",this.onObjectsSelected)}};return f};return c.$inject=["$timeout","Human","Tree","TreeCollapse"],{$get:c,config:function(c){a.extend(b,c)}}}).directive("objectTree",["$timeout","Human","ObjectTree",function(b,c,d){return{restrict:"E",templateUrl:"templates/scene/object-tree.html",scope:!0,transclude:!0,link:function(e,f){var g=f.find("human-tree"),h=function(a){e.show=i()&&a},i=function(){var b=e.rootObjects;return a.isArray(b)&&b.length>0};e.objectTreeConfig={compile:!1,compare:!0,itemId:"objectId",itemClasses:function(a){return{"anatomy-enabled":a.shown,"anatomy-selected":a.selected}},isLeaf:function(a){return a.isLeaf()}},e.rootObjects=c.scene.rootObjects,e.$watchCollection("rootObjects",function(c){var f;i()&&b(function(){e.sceneObjects=d.getSceneObjects(c),d.init(g)}),f=a.isObject(e.uiComponents.config)?!!e.uiComponents.config.objectTree:!1,h(f)}),e.$watch("uiComponents.config.objectTree",function(a){h(!!a)})}}}]),a.module("humanUI.timeline",[]).factory("hasAnimations",function(){return function(){var a=Human.timeline.activeRoot;if(a)for(var b,c,d,e=0;e<a._chapters.length;e++){if(b=a._chapters[e].maps,!Object.keys(b).length)return!1;for(d in b)if(b.hasOwnProperty(d)&&(c=b[d],"dummy"!==c.data.timeline))return!0}return!1}}).factory("hasPlayableTimeline",["hasAnimations",function(a){return function(b){if(a())return!0;var c=Object.keys(Human.timeline.chapters).length>1,d=b&&b.lastTime>b.firstTime;return c&&d}}]).factory("assetAttachClass",function(){return function(a){Human.events.on("graph.assetAttach.start",function(){a.addClass("asset-attach")}),Human.events.on("graph.assetAttach.finish",function(){a.removeClass("asset-attach")})}}).directive("playPauseTimeline",["Human",function(b){return{restrict:"A",scope:{config:"="},link:function(c,d){var e,f,g,h=function(){e={startTime:b.timeline.time},g=!!b.timeline.activeRoot._nowBranch.animation.loop,(f||g)&&(e.loop=!0);var d=a.isObject(c.config)&&c.config.tour;(d||g)&&(e.numChapters=1),b.timeline.play(e)};d.on("click",function(){b.timeline.playing?b.timeline.stop():h()});var i={played:!0,stopped:!1,scrubbed:!1};a.forEach(i,function(a,c){b.events.on("timeline."+c,function(){d[a?"addClass":"removeClass"]("playing")})}),b.events.on("modules.activating",function(a){var c=b.modules.modules[a.moduleId];c&&(f=!(!c.animation||!c.animation.loop))})}}}]).directive("humanPlayPause",["$timeout","assetAttachClass","hasPlayableTimeline",function(b,c,d){return{restrict:"E",scope:!0,templateUrl:"templates/timeline/play-pause.html",link:function(e,f){var g,h,i=function(){e.show=!!g&&!!h};c(f),Human.events.on("timeline.timeFrame.updated",function(a){b(function(){h=d(a),i(),e.$apply()})}),Human.events.on("modules.deactivated",function(){e.show=!1,e.$apply()}),e.$watch("uiComponents.config.playPause",function(b){var c=e.uiComponents.config;g=!c.scrubber&&!c.tour&&!!b,i(),a.isObject(b)&&(e.config=b)},!0)}}}]).directive("humanChapters",["$window","$sce","$timeout","Human","checkModule","translateFilter",function(b,c,d,e,f,g){var h=a.element(b);return{restrict:"E",scope:{config:"=?"},templateUrl:"templates/timeline/chapters.html",link:function(b,i,j){var k,l,m,n=j.chaptersMode||"scrubber",o=function(){m=i[0].scrollWidth>i[0].clientWidth,i[m?"addClass":"removeClass"]("overflow")},p=function(a){if(!b.titles.hasOwnProperty(a.chapterId)){var d=g(a,"displayName",l);b.titles[a.chapterId]=c.trustAsHtml(d)}return b.titles[a.chapterId]};b.titles={},b.getOffset=function(a){return"scrubber"===n?a/k.lastTime*100+"%":"auto"};var q=function(c){c&&c.length>1&&(k=e.timeline.getTimeFrame(),b.chapters=c,b.titleDisplay=a.isObject(b.config)&&b.config.titleDisplay?b.config.titleDisplay:p,d(o),b.showTitles=!f("ui.bootstrap"),b.toolTipPos="scrubber"===n?"left":"top")};i.on("click",function(a){if(/chapter/.test(a.target.className)){var c=e.timeline.chapters[a.target.id],d=function(){e.timeline.play({startChapterId:c.chapterId,loop:!!c.loop,numChapters:1})};if("scrubber"===n)d();else{var f=b.chapters.indexOf(c),g=f-b.curIndex;1===Math.abs(g)?e.timeline[1===g?"next":"prev"]():c.loop?d():e.timeline.scrub({chapterId:c.chapterId})}}}),h.on("resize",function(){d(o)}),b.$on("human.locale",function(a,b){l=b}),e.events.on("timeline.chapters.updated",q),e.events.on("timeline.timeFrame.updated",function(a){k=a}),e.events.on("timeline.chapters.activated",function(a){b.curIndex=a.newChapterIndex,b.$apply()})}}}]).directive("humanScrubber",["$filter","$timeout","Human","assetAttachClass","hasPlayableTimeline",function(b,c,d,e,f){return{restrict:"E",scope:!0,templateUrl:"templates/timeline/scrubber.html",link:function(g,h){var i,j,k,l,m,n=!1,o=function(){g.show=!!l&&!!m},p=function(b){g.uiConfig=b;var c=a.isObject(g.uiConfig)&&g.uiConfig.chapters;h[c?"addClass":"removeClass"]("chapters")},q=function(){return j=b("date")(1e3*d.timeline.time,"mm:ss"),k=b("date")(1e3*i.lastTime,"mm:ss"),j+" / "+k},r=function(a){return i.firstTime+(i.lastTime-i.firstTime)*a},s=function(a){i=a,g.config.value=d.timeline.time,g.config.max=i.lastTime,n||(n=!0,d.events.on("timeline.playing",function(a){g.config.value=a.time,g.$digest()}))};g.config={change:function(a){d.timeline.scrub({time:r(a.fraction)})},label:q},e(h),d.events.on("modules.deactivated",function(){g.show=!1,g.$apply()}),d.events.on("timeline.timeFrame.updated",function(a){c(function(){m=f(a),m&&s(a),o(),g.$apply()})}),d.events.on("timeline.chapters.updated",function(a){var b=g.uiComponents.config;b.scrubber&&b.tour&&(l=1===a.length,o(),g.$apply())}),g.$watch("uiComponents.config.scrubber",function(a){(!a||a&&!g.uiComponents.config.tour)&&(l=!!a,o()),p(a)},!0)}}}]).directive("prevNextChapter",["Human",function(a){return{restrict:"A",link:function(b,c,d){var e,f,g=d.prevNextChapter||"next",h=function(a){f=!!("next"===g&&a===e.length-1||"prev"===g&&0===a),c[f?"addClass":"removeClass"]("disabled")};c.on("click",function(){f||a.timeline[g]()}),a.events.on("timeline.chapters.updated",function(a){e=a}),a.events.on("timeline.chapters.activated",function(a){h(a.newChapterIndex)})}}}]).directive("humanTour",["$q","$timeout","Human","assetAttachClass",function(b,c,d,e){return{restrict:"E",scope:!0,templateUrl:"templates/timeline/tour.html",link:function(b,f){var g,h,i=function(){b.show=!!g&&!!h},j=function(c){b.uiConfig=c;var d=a.isObject(b.uiConfig)&&b.uiConfig.chapters;f[d?"addClass":"removeClass"]("chapters")};e(f),d.events.on("modules.deactivated",function(){b.show=!1,b.$apply()}),d.events.on("timeline.chapters.updated",function(a){var d=b.uiComponents.config;c(function(){h=a.length>1,d.scrubber&&d.tour&&(g=h),i(),b.$apply()})}),b.$watch("uiComponents.config.tour",function(a){(!a||a&&!b.uiComponents.config.scrubber)&&(g=!!a,i()),j(a)},!0)}}}]),a.module("humanUI.tree",[]).filter("escapeHtml",function(){var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},c=[];a.forEach(b,function(a,b){c.push(b)});var d=new RegExp("(?:"+c.join("|")+")","g"),e=function(a){return b[a]};return function(a){return a.replace(d,e)}}).factory("Tree",["$interpolate",function(b){var c,d,e;return{collapseTemplate:"<span collapse></span>",compare:function(a,b,c){var d,e,f,g=[],h=[],i={},j={};if(b){for(d=0;d<a.length;d++)i[a[d][c]]=a[d];for(d=0;d<b.length;d++)j[b[d][c]]=b[d];for(e in i)i.hasOwnProperty(e)&&!j.hasOwnProperty(e)&&g.push(i[e]);for(e in j)j.hasOwnProperty(e)&&!i.hasOwnProperty(e)&&h.push(j[e]);f={toAdd:g,toRemove:h}}else f={toAdd:a,toRemove:h};return f},buildClasses:function(a,b,c){var f;d=[],e=c?c(a):{},b&&(e["tree-leaf"]=!0);for(f in e)e.hasOwnProperty(f)&&e[f]&&d.push(f);return d.join(" ")},_buildDOMString:function(a,d,e,f){var g,h,i,j,k,l=f?"<ul>":"";i=e.itemId?' id="{{'+e.itemId+' | escapeHtml }}"':"";var m="<li"+i+' class="{{ classes }}">';for(k=0;k<d.length;k++)c=d[k],g=e.isLeaf?e.isLeaf(c):!1,j=e.itemClasses,c.classes=this.buildClasses(c,g,j),h=m+(g?"":this.collapseTemplate)+a,h=b(h)(c),delete c.classes,g||(h+=this._buildDOMString(a,c.objects,e,!0)),l+="</li>"+h;return l+=f?"</ul>":""},buildDOMString:function(a,b,c,d){return this._buildDOMString(a,b,c,d)},lis:{},buildLis:function(a){if(a&&a.length)for(var b=0;b<a.length;b++)this.lis[a[b].id]=a[b]},emptyLis:function(){for(var a in this.lis)this.lis.hasOwnProperty(a)&&delete this.lis[a]},getLi:function(b){return this.lis[b]?a.element(this.lis[b]):void 0},removeLi:function(a){this.lis[a]&&(this.lis[a].remove(),delete this.lis[a])},updateState:function(b,c){a.forEach(b,c)}}}]).factory("TreeCollapse",["$timeout",function(b){var c={animate:!0};return{show:function(d,e){if(!d.data("transitioning")){var f=d.parent();e=a.extend({},c,e);var g=e.animate;f.removeClass("collapsed").addClass("opening"),g&&d.addClass("transitioning"),d.css("height",0),d.data("transitioning",!0),f.data("collapsed",!1);var h=function(){g&&d.removeClass("transitioning"),f.addClass("open").removeClass("opening"),d.css("height","auto"),d.data("transitioning",!1)};g?b(h,350):b(h),d.css("height",d[0].scrollHeight+"px")}},hide:function(d,e){var f;if(!d.data("transitioning")){var g=d.parent();e=a.extend({},c,e);var h=e.animate;f=d.css("height",d[0].offsetHeight+"px")[0].offsetHeight,h&&d.addClass("transitioning"),g.removeClass("open").addClass("collapsing"),d.data("transitioning",!0);var i=function(){d.data("transitioning",!1),h&&d.removeClass("transitioning"),g.addClass("collapsed").removeClass("collapsing"),g.data("collapsed",!0)};d.css("height",0),h?b(i,350):b(i)}},toggle:function(a){this[a.parent().data("collapsed")?"show":"hide"](a)},getTarget:function(b){if(b)for(var c=b.children(),d=0;d<c.length;d++)if("ul"===c[d].tagName.toLowerCase())return a.element(c[d])},globalBind:function(b){var c=this;b.off("click.collapseToggle"),b.on("click.collapseToggle",function(b){if(b.target.hasAttribute("collapse")){b.stopPropagation();var d=a.element(b.target),e=d.parent();c.toggle(c.getTarget(e))}})},init:function(a){a.find("li").addClass("collapsed").data("collapsed",!0),a.children().find("ul").css("height","0px")}}}]).directive("collapse",["TreeCollapse",function(a){return{restrict:"A",link:function(b,c){c.off("click.collapseToggle"),c.on("click.collapseToggle",function(b){b.stopPropagation();var d=c.parent();a.toggle(a.getTarget(d))})}}}]).directive("humanTree",["$compile","Tree","TreeCollapse",function(b,c,d){return{restrict:"E",scope:{treeData:"=",treeConfig:"="},compile:function(e){var f=e[0].innerHTML;e.empty();var g=function(e,g){var h=function(h,i){var j=e.treeConfig||{};if(j.compare&&j.itemId){for(var k,l,m,n,o=c.compare(h,i,j.itemId),p=0;p<o.toRemove.length;p++)c.removeLi(o.toRemove[p][j.itemId]);k=g[0].firstChild,l=k&&"ul"===k.tagName.toLowerCase(),m=l?a.element(k):g,n=c.buildDOMString(f,o.toAdd,j,!l),m.append(n)}else n=c.buildDOMString(f,h,j,!0),g.empty().append(n);j.compile===!1?d.globalBind(g):b(g.contents())(e),d.init(g),c.emptyLis(),c.buildLis(g.find("li"))};e.$watch("treeData",function(a,b){a&&h(a,b)})};return g}}}]),a.module("humanUI.templates",["templates/annotations/panel.html","templates/bookmark/tour.html","templates/camera/center.html","templates/camera/mode.html","templates/camera/pan.html","templates/camera/zoom-in.html","templates/camera/zoom-out.html","templates/camera/zoom.html","templates/cross-section/camera-clip.html","templates/cross-section/controls.html","templates/cross-section/slider.html","templates/cross-section/toggle.html","templates/dissect/dissect.html","templates/dissect/undo.html","templates/fullscreen/panel.html","templates/fullscreen/window-link.html","templates/info/panel.html","templates/load/progress.html","templates/media/audio.html","templates/modes/isolate.html","templates/modes/xray.html","templates/scene/object-tree.html","templates/timeline/chapters.html","templates/timeline/play-pause.html","templates/timeline/scrubber.html","templates/timeline/tour.html","templates/utilities/slider.html"]),a.module("templates/annotations/panel.html",[]).run(["$templateCache",function(a){a.put("templates/annotations/panel.html",'<button\n  class="tool annotations"\n  toggle-button="toggleAnnotations">\n</button>')}]),a.module("templates/bookmark/tour.html",[]).run(["$templateCache",function(a){a.put("templates/bookmark/tour.html",'<div>\n  <button prev-next-bookmark="prev"></button>\n\n  <div id=\'bookmark-tour-captures\' update-scroll="state.curCaptureIndex">\n    <div class="bookmark-tour-capture"\n      ng-repeat="capture in state.captures"\n      ng-class="{ on: $index === state.curCaptureIndex }"\n      ng-click="restore($index)">\n\n      <img ng-src="/{{ capture.thumbnailSrc }}">\n    </div>\n  </div>\n\n  <button prev-next-bookmark="next"></button>\n</div>')}]),a.module("templates/camera/center.html",[]).run(["$templateCache",function(a){a.put("templates/camera/center.html","<div center-camera></div>")}]),a.module("templates/camera/mode.html",[]).run(["$templateCache",function(a){a.put("templates/camera/mode.html",'<div toggle-button="cameraMode"></div>')}]),a.module("templates/camera/pan.html",[]).run(["$templateCache",function(a){a.put("templates/camera/pan.html",'<div pan-camera="up" title="Pan Up [{{ keys.up }}]"></div>\n<div pan-camera="right" title="Pan Right [{{ keys.right }}]"></div>\n<div pan-camera="down" title="Pan Down [{{ keys.down }}]"></div>\n<div pan-camera="left" title="Pan Left [{{ keys.left }}]"></div>\n\n<div center-camera title="Center"></div>')}]),a.module("templates/camera/zoom-in.html",[]).run(["$templateCache",function(a){a.put("templates/camera/zoom-in.html",'<div zoom-camera="in">+</div>')}]),a.module("templates/camera/zoom-out.html",[]).run(["$templateCache",function(a){a.put("templates/camera/zoom-out.html",'<div zoom-camera="out">-</div>')}]),a.module("templates/camera/zoom.html",[]).run(["$templateCache",function(a){a.put("templates/camera/zoom.html",'<div zoom-camera="out">-</div>\n<div zoom-camera="in">+</div>')}]),a.module("templates/cross-section/camera-clip.html",[]).run(["$templateCache",function(a){a.put("templates/cross-section/camera-clip.html",'<button\n  class="tool camera-clip"\n  toggle-button="toggleCameraClip"></button>')}]),a.module("templates/cross-section/controls.html",[]).run(["$templateCache",function(a){a.put("templates/cross-section/controls.html",'<button\n  class="tool"\n  cycle-section-plane\n  uib-tooltip="{{ tooltipText.select }}"></button>\n\n<human-cross-section-slider></human-cross-section-slider>\n<span class="view">{{ state.current.view }}</span>\n\n<button\n  class="tool"\n  reset-section-plane\n  plane="curPlane"\n  uib-tooltip="{{ tooltipText.reset }}"></button>')}]),a.module("templates/cross-section/slider.html",[]).run(["$templateCache",function(a){a.put("templates/cross-section/slider.html",'<human-slider config="config"></human-slider>')}]),a.module("templates/cross-section/toggle.html",[]).run(["$templateCache",function(a){a.put("templates/cross-section/toggle.html",'<button class="cross-section tool" toggle-button="callbacks"></button>')}]),a.module("templates/dissect/dissect.html",[]).run(["$templateCache",function(a){a.put("templates/dissect/dissect.html",'<button\n  class="tool dissect"\n  toggle-button="toggleDissect"\n  toggle-model="shown"></button>')}]),a.module("templates/dissect/undo.html",[]).run(["$templateCache",function(a){a.put("templates/dissect/undo.html",'<button class="tool dissect-undo" undo-dissect></button>')}]),a.module("templates/fullscreen/panel.html",[]).run(["$templateCache",function(a){a.put("templates/fullscreen/panel.html",'<div toggle-button="toggleFullscreen"></div>')}]),a.module("templates/fullscreen/window-link.html",[]).run(["$templateCache",function(a){a.put("templates/fullscreen/window-link.html",'<a window-link target="_blank"></a>')}]),a.module("templates/info/panel.html",[]).run(["$templateCache",function(a){a.put("templates/info/panel.html",'<h1 class="title">{{ infoTitle }}</h1>\n<div class="description" ng-bind-html="infoDescription | parseActions"></div>\n<ng-transclude class="custom-content"></ng-transclude>')}]),a.module("templates/load/progress.html",[]).run(["$templateCache",function(a){a.put("templates/load/progress.html",'<div class="progress-indicator">\n  <span>{{ progressPercent }}</span>\n</div>\n\n<div class="status-text">\n  <span>{{ statusText }}</span>\n</div>')}]),a.module("templates/media/audio.html",[]).run(["$templateCache",function(a){a.put("templates/media/audio.html",'<audio autoplay></audio>\n<button mute-replay-audio class="tool"></button>')}]),a.module("templates/modes/isolate.html",[]).run(["$templateCache",function(a){a.put("templates/modes/isolate.html",'<button class="tool isolate" toggle-button="toggleIsolate"></button>')}]),a.module("templates/modes/xray.html",[]).run(["$templateCache",function(a){a.put("templates/modes/xray.html",'<button class="tool xray" toggle-button="toggleXray"></button>')}]),a.module("templates/scene/object-tree.html",[]).run(["$templateCache",function(a){a.put("templates/scene/object-tree.html",'<ng-transclude></ng-transclude>\n<human-tree\n  tree-data="sceneObjects"\n  tree-config="objectTreeConfig">\n    <a\n      object-selected="{{ objectId | escapeHtml }}"\n      title="{{ displayName | escapeHtml }}"\n      class="tree-item">\n      <span\n        object-enabled="{{ objectId | escapeHtml }}"\n        class="anatomy-check-icon"></span>{{ displayName | escapeHtml }}\n    </a>\n</human-tree>')}]),a.module("templates/timeline/chapters.html",[]).run(["$templateCache",function(a){a.put("templates/timeline/chapters.html",'<button\n  ng-repeat="chapter in chapters"\n  id="{{ chapter.chapterId }}"\n  class="chapter"\n  ng-class="{ on: $index === curIndex }"\n  uib-tooltip-html="titleDisplay(chapter)"\n  tooltip-placement="{{ toolTipPos }}"\n  title="{{ (showTitles && titleDisplay(chapter)) || \'\' }}"\n  ng-style="{ left: getOffset(chapter.time) }">{{ $index + 1 }}</button>')}]),a.module("templates/timeline/play-pause.html",[]).run(["$templateCache",function(a){a.put("templates/timeline/play-pause.html",'<button play-pause-timeline config="config"></button>')}]),a.module("templates/timeline/scrubber.html",[]).run(["$templateCache",function(a){a.put("templates/timeline/scrubber.html",'<button play-pause-timeline config="uiConfig"></button>\n\n<human-chapters chapters-mode="scrubber" config="uiConfig"></human-chapters>\n<human-slider config="config"></human-slider>')}]),a.module("templates/timeline/tour.html",[]).run(["$templateCache",function(a){a.put("templates/timeline/tour.html",'<div><button prev-next-chapter="prev"></button><human-chapters chapters-mode="tour" config="uiConfig"></human-chapters><button prev-next-chapter="next"></button></div>')}]),a.module("templates/utilities/slider.html",[]).run(["$templateCache",function(a){a.put("templates/utilities/slider.html",'<div class="track">\n  <div class="progress"></div>\n  <div class="handle"\n    ng-mouseover="showLabel = !!config.label"\n    ng-mouseleave="showLabel = false">\n    <div class="progress-label" ng-show="showLabel">{{ label }}</div>\n  </div>\n</div>')}])}(angular);