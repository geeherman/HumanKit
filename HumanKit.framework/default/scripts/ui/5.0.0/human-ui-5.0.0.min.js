!function(a){"use strict";a.module("humanUI",["humanUI.config","humanUI.tree","humanUI.load","humanUI.camera","humanUI.timeline","humanUI.crossSection","humanUI.annotations","humanUI.dissect","humanUI.modes","humanUI.info","humanUI.media","humanUI.scene","humanUI.fullscreen","humanUI.templates"]).run(["$rootScope","Human",function(a,b){b.properties.subscribe({propId:"locale",callback:function(b){a.$broadcast("human.locale",b)}})}]).constant("MIN_HUMAN_VERSION","4.0.0").factory("Human",["MIN_HUMAN_VERSION",function(b){var c,d,e,f=[];a.forEach([Human.VERSION,b],function(a){a.replace(/^(\d+)\.(\d+)\.(\d+)-?(\w+)?$/,function(a,b,c,d,e){f.push({major:b,minor:c,patch:d,client:e||null})})});var g=["Human",Human.VERSION,"is not reliably supported! Use",b,"or higher."].join(" "),h=function(a){0!==a.length&&(e=a.shift(),c=f[0][e],d=f[1][e],d>c?console.warn(g):c===d&&h(a))};return h(["major","minor","patch"]),Human}]).factory("humanLoaded",["$q","Human",function(a,b){var c=a.defer();return b.events.on("loaded",function(){c.resolve()}),c.promise}]).factory("destroyInterval",["$interval",function(b){return function(c){a.isDefined(c)&&(b.cancel(c),c=void 0)}}]).factory("checkModule",function(){return function(b){try{a.module(b)}catch(c){return!1}return!0}}).factory("isBaseAnatomy",function(){return function(b){return a.isObject(b)?/(fe)?maleAdult\.json$/.test(b.moduleId):!1}}).filter("excludeBaseAnatomy",["isBaseAnatomy",function(a){return function(b){return a(b)?null:b}}]).filter("parseActions",["$sce","Human",function(b,c){return function(d){return a.isString(d)?b.trustAsHtml(c.actions.parse(d)):""}}]).filter("translate",function(){return function(a,b,c){var d=a[b];return c&&a.translations&&a.translations[c]&&(d=a.translations[c][b]||d),d}}).filter("getOffset",["$window",function(a){return function(b){b=b||a.event;var c=b.target||b.srcElement,d=c.getBoundingClientRect(),e=b.clientX-d.left,f=b.clientY-d.top;return{x:e,y:f}}}]).directive("toggleButton",function(){return{restrict:"A",scope:{config:"=toggleButton"},link:function(b,c,d){var e,f="on"===d.toggleDefault,g=function(b){a.isDefined(b)&&(f=!!b,c[f?"addClass":"removeClass"]("on"))};f&&c.addClass("on"),c.on("click",function(){f=!f,e=f?"on":"off",a.isFunction(b.config[e])&&b.config[e](),b.$apply()}),b.$watch("config.model",function(a,b){a!==b&&g(a)})}}}).directive("humanSlider",["$document","$timeout","$filter",function(b,c,d){return{restrict:"E",scope:{config:"="},templateUrl:"templates/ui/slider.html",link:function(c,e){var f,g,h,i=0,j=0,k={min:0,max:1,range:1},l=e.children(),m=l.children(),n=m.eq(0),o=m.eq(1),p=l[0],q=function(){h=100*g+"%",o.css("left",h),n.css("width",h),c.config.label&&(c.label=c.config.label())},r=function(b,c){a.isNumber(c)&&(k[b]=c,k.range=k.max-k.min)},s=function(a){g=a/p.offsetWidth,c.config.value=g*k.range+k.min,c.config.change&&c.config.change({x:a,fraction:g}),c.$apply()},t=function(a){j=a.clientX-i,0>j?j=0:j>p.offsetWidth&&(j=p.offsetWidth),s(j)},u=function(){b.off("mousemove",t),b.off("mouseup",u)};o.on("mousedown",function(a){a.preventDefault(),a.stopPropagation(),i=a.clientX-j,b.on("mousemove",t),b.on("mouseup",u)}),l.on("mousedown",function(a){f=a.offsetX||d("getOffset")(a).x,s(j=f)}),c.$watch("config.min",function(a){r("min",a)}),c.$watch("config.max",function(a){r("max",a)}),c.$watch("config.value",function(b){a.isNumber(b)&&(g=(b-k.min)/k.range,j=g*p.offsetWidth,q())})}}}]).directive("draggable",["$document","$window",function(a,b){return{restrict:"A",link:function(c,d){var e,f,g,h,i,j=0,k=0,l=d.find("drag-handle");l.length||(l=d);var m=function(){e=d[0].getBoundingClientRect(),h=e.left,i=e.top},n=function(a,c){return g="x"===c?b.innerWidth:b.innerHeight,f="x"===c?"width":"height",0>a&&(a=0),a+e[f]>g&&(a=g-e[f]),a};l.on("mousedown",function(b){b.preventDefault(),0===h&&0===i&&m(),j=b.pageX-h,k=b.pageY-i,e=d[0].getBoundingClientRect(),a.on("mousemove",o),a.on("mouseup",p)});var o=function(a){h=n(a.pageX-j,"x"),i=n(a.pageY-k,"y"),d.css({left:h+"px",top:i+"px"})},p=function(){a.off("mousemove",o),a.off("mouseup",p)};m()}}}]),a.module("humanUI.annotations",[]).directive("humanAnnotations",["Human",function(a){return{restrict:"E",scope:!0,templateUrl:"templates/annotations/panel.html",link:function(b){var c=a.view.annotations;b.toggleAnnotations={on:c.setShown.bind(c,!0),off:c.setShown.bind(c,!1)},a.events.on("annotations.shown",function(a){b.toggleAnnotations.model=a.shown,b.$apply()}),b.$watch("uiComponents.config.annotations",function(a){b.show=!!a})}}}]),a.module("humanUI.camera",[]).constant("PAN_PARAMS",{interval:10}).constant("PAN_KEYS",{up:"W",down:"S",left:"D",right:"A"}).factory("getPanRate",["Human",function(a){var b=new Float64Array(3),c=new Float64Array(3),d=new Float64Array(3),e=function(a,b){b[0]=a.x,b[1]=a.y,b[2]=a.z};return function(){return e(a.view.camera.getEye(),b),e(a.view.camera.getLook(),c),d=a.math.subVec3(b,c,d),.12*a.math.lenVec3(d)}}]).directive("centerCamera",["Human",function(a){return{restrict:"A",link:function(b,c){c.on("click",function(){a.init.resetCamera()})}}}]).directive("panCamera",["$interval","PAN_PARAMS","Human","getPanRate","destroyInterval",function(a,b,c,d,e){return{restrict:"A",link:function(f,g,h){var i,j,k,l,m,n=h.panCamera||"up";g.on("mousedown",function(){l=b.interval/1e3*d(),m=a(function(){switch(i=0,j=0,k=0,n){case"up":j=-l;break;case"down":j=l;break;case"left":i=-l;break;case"right":i=l}c.view.camera.pan({x:i,y:j,z:k})},b.interval)}),g.on("mouseup",function(){e(m)}),g.on("mouseleave",function(){e(m)})}}}]).directive("humanCameraPan",["PAN_KEYS",function(a){return{restrict:"E",scope:!0,templateUrl:"templates/camera/pan.html",link:function(b){b.keys=a,b.$watch("uiComponents.config.pan",function(a){b.show=!!a})}}}]).constant("ZOOM_PARAMS",{step:.05,interval:10}).directive("zoomCamera",["$interval","ZOOM_PARAMS","Human","destroyInterval",function(a,b,c,d){return{restrict:"A",link:function(e,f,g){var h,i="out"===g.zoomCamera?1:-1;f.on("mousedown",function(){h=a(function(){c.view.camera.zoom(b.step*i)},b.interval)}),f.on("mouseup",function(){d(h)}),f.on("mouseleave",function(){d(h)})}}}]).directive("humanCameraZoom",function(){return{restrict:"E",scope:!0,templateUrl:"templates/camera/zoom.html",link:function(a){a.$watch("uiComponents.config.zoom",function(b){a.show=!!b})}}}),a.module("humanUI.config",[]).constant("BASE_CONFIG",{annotations:!1,audio:!1,info:!1,loadProgress:!0,pan:!0,zoom:!0,objectTree:!1,playPause:!1,scrubber:!1,tour:!1,crossSection:!1,dissect:!1,isolate:!1,xray:!1}).constant("CONFIG_GROUPS",{nav:["pan","zoom"],scene:["objectTree"],tools:["crossSection","dissect"],modes:["isolate","xray"]}).constant("CONFIG_ALIASES",{loader:"loadProgress",panel:"info",tree:"objectTree"}).filter("convertTags",function(){return function(b,c){return a.isArray(c)&&c.length>0&&(c.has=function(a){return this.indexOf(a)>-1},c.has("scrubber")||c.has("scrubber-chapters")?(b.scrubber=!0,c.has("scrubber-chapters")&&(b.scrubber={chapters:!0},c.has("tour")&&(b.scrubber.tour=!0))):(c.has("play-controls")&&(b.playPause=!0),c.has("tour")&&(b.tour=!0)),delete c.has),b}}).filter("extendConfig",["CONFIG_ALIASES","CONFIG_GROUPS",function(b,c){return function(d,e){return a.forEach(c,function(b,c){e.hasOwnProperty(c)&&a.forEach(b,function(a){d[a]=e[c]})}),a.extend(d,e),a.forEach(c,function(a,b){d.hasOwnProperty(b)&&delete d[b]}),a.forEach(b,function(a,b){d.hasOwnProperty(b)&&(d[a]=d[b],delete d[b])}),d}}]).filter("uiParams",["CONFIG_ALIASES",function(b){var c,d,e=/^ui-/,f=function(a){return"true"===a?!0:"false"===a||""===a?!1:a};return function(g){var h,i={};return a.forEach(g,function(a,g){(e.test(g)||b.hasOwnProperty(g))&&(d=g.replace(e,"").replace(/-([a-z])/g,function(a){return a[1].toUpperCase()}).split("."),a=f(a),d.length>1?(c=d.shift(),i[c]=i[c]||{},h=i[c]):h=i,h[d.shift()]=a)}),i}}]).factory("ConfigCreator",["BASE_CONFIG","Human","uiComponents","extendConfigFilter","convertTagsFilter","uiParamsFilter",function(b,c,d,e,f,g){return{config:{},params:g(c.request.getSearchParams()),init:function(){c.events.on("modules.activating",this._extend.bind(this))},_extend:function(g){var h=a.extend({},b),i=c.modules.modules[g.moduleId],j=i.ui||{};e(h,j),f(h,i.tags),e(h,this.params),d.config=h}}}]).value("uiComponents",{}).run(["$rootScope","ConfigCreator","uiComponents",function(a,b,c){b.init(),a.uiComponents=c}]),a.module("humanUI.crossSection",[]).factory("Clip",["Human",function(a){return{MAP:[{view:"Anterior",clip:a.view.clip.FRONT},{view:"Posterior",clip:a.view.clip.BACK},{view:"Top",clip:a.view.clip.TOP},{view:"Right",clip:a.view.clip.RIGHT},{view:"Bottom",clip:a.view.clip.BOTTOM},{view:"Left",clip:a.view.clip.LEFT}],show:function(b){a.view.clip.setClip({state:"clipping"}),a.view.clip.selectClip(b),a.view.clip.setClip({state:"visible"})},reset:a.view.clip.reset.bind(a.view.clip)}}]).directive("cycleSectionPlane",["Clip",function(a){return{restrict:"A",scope:{curPlane:"=plane"},link:function(b,c){var d=0;c.on("click",function(){d=d===a.MAP.length-1?0:d+1,b.curPlane=a.MAP[d],a.show(b.curPlane.clip),b.$apply()})}}}]).directive("resetSectionPlane",["Clip",function(a){return{restrict:"A",scope:{curPlane:"=plane"},link:function(b,c){c.on("click",function(){b.curPlane=a.MAP[0],a.reset(),a.show(b.curPlane.clip),b.$apply()})}}}]).directive("humanCrossSectionSlider",["Human",function(a){return{restrict:"E",scope:!0,templateUrl:"templates/cross-section/slider.html",link:function(b){b.config={value:0,change:function(b){a.view.clip.setClip({state:"visible",progress:b.fraction})}},a.events.on("clip.updated",function(a){b.config.value=a.progress||0,b.$apply()})}}}]).directive("humanCrossSection",["Clip","Human",function(a,b){return{restrict:"E",scope:!0,templateUrl:"templates/cross-section/panel.html",link:function(c){c.curPlane=a.MAP[0];var d=function(a){b.view.clip.setClip({clipId:b.view.clip.selectedClip.clipId,state:a})};c.callbacks={on:function(){d("visible"),c.showControls=c.callbacks.model=!0},off:function(){d("clipping"),c.showControls=c.callbacks.model=!1}},c.$watch("uiComponents.config.crossSection",function(a){c.show=!!a})}}}]),a.module("humanUI.dissect",[]).directive("undoDissect",["Human",function(a){return{restrict:"A",scope:!0,link:function(b,c){var d=!0;c.addClass("disabled"),c.on("click",function(){d||a.view.dissect.undo()}),a.events.on("dissect.toggled",function(a){d=!a.enabled,c[d?"addClass":"removeClass"]("disabled")})}}}]).directive("humanDissect",["Human",function(a){return{restrict:"E",scope:!0,templateUrl:"templates/dissect/panel.html",link:function(b){var c=function(b){a.rpc.call(null,"dissect.setEnabled",{enabled:b})};b.toggleDissect={on:c.bind(null,!0),off:c.bind(null,!1)},a.events.on("dissect.toggled",function(a){b.toggleDissect.model=a.enabled,b.$apply()}),b.$watch("uiComponents.config.dissect",function(a){b.show=!!a})}}}]),a.module("humanUI.fullscreen",[]).factory("Fullscreen",["$document","$rootScope",function(b,c){var d,e=b[0],f=e.body,g={request:[f.requestFullscreen,f.webkitRequestFullscreen,f.mozRequestFullScreen,f.msRequestFullscreen],exit:[e.exitFullscreen,e.webkitExitFullscreen,e.mozCancelFullScreen,e.msExitFullscreen]};return{VENDOR_PREFIXES:["","webkit","moz","ms"],setMethods:function(){var b,c={};for(var d in g)if(g.hasOwnProperty(d)){b=g[d];for(var h=0;h<b.length;h++)if(a.isFunction(b[h])){c[d]=b[h];break}if(!c[d])return!1}return this.request=c.request.bind(f),this.exit=c.exit.bind(e),!0},isActive:function(){return d=e.fullscreenElement||e.webkitFullscreenElement||e.mozFullScreenElement||e.msFullscreenElement||void 0,!!d},bindHandlers:function(){var d,f=this;b.on("keypress",function(a){70===a.which&&a.shiftKey&&f.toggle()}),a.forEach(this.VENDOR_PREFIXES,function(a){var b=a+"fullscreenchange";e.addEventListener(b,function(){d=f.isActive(),c.$broadcast("fullscreen.change",{active:d,fromUI:f._fromUI}),f._fromUI=!1},!1)})},_fromUI:!1,toggle:function(){this._fromUI=!0,this[this.isActive()?"exit":"request"]()}}}]).run(["Fullscreen",function(a){var b=a.setMethods();b&&a.bindHandlers()}]),a.module("humanUI.info",[]).directive("humanInfoPanel",["$parse",function(b){return{restrict:"E",templateUrl:"templates/info/panel.html",scope:{info:"="},transclude:!0,link:function(c,d,e){var f={title:"title",description:"description"};if(e.infoProperties){var g=b(e.infoProperties)({});f=a.extend(f,g)}c.$watch("info",function(a){a&&(c.infoTitle=a[f.title],c.infoDescription=a[f.description])})}}}]),a.module("humanUI.load",[]).constant("DEFAULT_STATUS_TEXT","Loading, please wait...").constant("INITIAL_STATUS_TEXT","Assembling the Human for first time use...").factory("Process",["DEFAULT_STATUS_TEXT",function(a){var b,c={},d=[];return{get:function(a){return c[a]},create:function(e,f){return b={parentProcess:f,statusText:e.statusText||a,progress:e.progress||0},c[e.processId]=b,d.push(b),b},destroy:function(a){return delete c[a],d.pop(),d.length}}}]).filter("progressPercent",function(){return function(a){return a=Math.max(0,Math.min(100,Math.floor(a||0))),Math.round(a)+"%"}}).directive("humanLoadProgress",["INITIAL_STATUS_TEXT","Human","Process",function(b,c,d){return{restrict:"E",scope:!0,templateUrl:"templates/load/progress.html",link:function(e,f){var g=null,h=null;e.initialStatusText=b;var i=c.cookies.getCookie("human-app-initialized");e.initialized="true"===i,e.initialized||c.cookies.setCookie("human-app-initialized","true"),e.showProgress=function(b){return a.isNumber(b)&&b>0},c.events.on("processes.started",function(a){e.curProcess=h=d.create(a,h),e.$apply()}),c.events.on("processes.updated",function(a){g=d.get(a.processId),g&&(a.statusText&&(g.statusText=a.statusText),a.progress&&(g.progress=a.progress)),e.$apply()});var j=function(a){d.destroy(a.processId),e.curProcess=h=h.parentProcess,h||(e.show=!1),e.$apply()};c.events.on("processes.finished",j),c.events.on("processes.failed",j),e.$watch("uiComponents.config.loadProgress",function(b){a.isString(b)&&!f.hasClass(b)&&f.addClass(b),e.show=!!b})}}}]),a.module("humanUI.media",[]).constant("AUDIO_TYPES",{ogg:'audio/ogg;codecs="vorbis"',mp3:"audio/mpeg;"}).constant("AUDIO_PATH","/content/states/{{ modelId }}/audio/sounds/{{ src }}").factory("Media",["$document","$interpolate","AUDIO_TYPES","AUDIO_PATH",function(a,b,c,d){var e={},f={};return{supportTest:function(b){if(e.hasOwnProperty(b))return e[b];if(!b&&e.hasOwnProperty("audio"))return e.audio;var d=a[0].createElement("audio"),f=!!d.canPlayType;return b?(f=f&&!!d.canPlayType(c[b]||b),e[b]=f):e.audio=f,f},getSupportedSrc:function(a,c){if(f[a.clipId])return f[a.clipId];var e=b(d)({modelId:c,src:a.src}),g=a.src.match(/\.(\w+)$/);g=g&&g[1];for(var h=[g].concat(a.alternatives||[]),i=0;i<h.length;i++)if(this.supportTest(h[i]))return f[a.clipId]=e.replace(/\.\w+$/,"."+h[i]),f[a.clipId];return!1}}}]).directive("muteReplayAudio",function(){return{restrict:"A",scope:!0,link:function(b,c){c.on("click",function(){b[b.states.ended?"replay":"toggleMute"](),b.$apply()}),b.$watch("states",function(b){a.forEach(["ended","muted"],function(a){c[b[a]?"addClass":"removeClass"](a)})},!0)}}}).directive("humanAudio",["$q","Human","Media",function(a,b,c){return{restrict:"E",scope:!0,templateUrl:"templates/media/audio.html",link:function(d,e){var f,g,h,i,j=e.find("audio")[0],k=a.defer();d.states={ended:!1,muted:!1},d.replay=function(){j.currentTime=0,j.play(),d.states.ended=!1},d.toggleMute=function(){j.muted=!j.muted,d.states.muted=j.muted},j.addEventListener("ended",function(){d.states.ended=!0,d.$apply()}),j.addEventListener("playing",function(){d.states.ended=!1,d.$apply()}),b.events.on("audio.clips",function(){g=b.media.audio.clips}),b.events.on("audio.suggestedClips",function(a){i&&(0!==a.length&&g?(h=g[a[0]],k.promise.then(function(a){j.src=c.getSupportedSrc(h,a)}),d.show=!0):d.show=!1)}),b.events.on("modules.activated",function(a){f=b.modules.modules[a.moduleId],f.modelIds&&k.resolve(f.modelIds[0])}),d.$watch("uiComponents.config.audio",function(a){i=!!a})}}}]),a.module("humanUI.modes",[]).directive("humanXray",["Human",function(a){return{restrict:"E",scope:!0,templateUrl:"templates/modes/xray.html",link:function(b){b.toggleXray={on:a.view.setModeEnabled.bind(a.view,"xray"),off:a.view.setModeEnabled.bind(a.view,"highlight")},a.events.on("xray.toggled",function(a){b.toggleXray.model=a.enabled,b.$apply()}),b.$watch("uiComponents.config.xray",function(a){b.show=!!a})}}}]).directive("humanIsolate",["Human",function(a){return{restrict:"E",scope:!0,templateUrl:"templates/modes/isolate.html",link:function(b){b.toggleIsolate={on:a.view.setModeEnabled.bind(a.view,"isolate"),off:a.view.setModeEnabled.bind(a.view,"highlight")},a.events.on("isolate.toggled",function(a){b.toggleIsolate.model=a.enabled,b.$apply()}),b.$watch("uiComponents.config.isolate",function(a){b.show=!!a})}}}]),a.module("humanUI.scene",[]).filter("escapeHtml",function(){var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},c=[];a.forEach(b,function(a,b){c.push(b)});var d=new RegExp("(?:"+c.join("|")+")","g");return function(a){return a.replace(d,function(a){return b[a]})}}).factory("ObjectTree",["escapeHtmlFilter",function(b){return{isBase:function(a,b){var c=b?/(fe)?maleAdult\.json$/:/(fe)?maleAdult/;return c.test(a)},getRootObjects:function(b){var c=this,d=[];return a.forEach(b,function(a){c.isBase(a.objectId)?d.push(a):d=d.concat(a.objects)}),d},build:function(a){var c=this.getRootObjects(a),d=function(a){for(var c,e,f=[],g=0;g<a.length;g++)e=a[g],c={objectId:b(e.objectId),displayName:b(e.displayName),selected:e.selected,shown:e.shown},c.objects=d(e.objects),f.push(c);return f};return d(c)}}}]).directive("objectEnabled",["Tree",function(a){return{restrict:"A",link:function(b,c,d){var e,f=function(a){var b={};b[d.objectEnabled]=a,Human.scene.setEnabledObjects({objects:b})},g=function(b,d){e=a.getLi(c,d),e&&e[b?"addClass":"removeClass"]("anatomy-enabled")};d.objectEnabled?(e=c.parent().parent(),c.on("click",function(a){a.stopPropagation(),e.toggleClass("anatomy-enabled"),f(e.hasClass("anatomy-enabled"))})):Human.events.on("scene.objectsShown",function(b){var c=b.enabledObjectsUpdate;a.updateState(c,g)})}}}]).directive("objectSelected",["Human","Tree","ObjectTree",function(b,c,d){return{restrict:"A",link:function(e,f,g){var h,i,j=function(b,c){i=b.children()[0],i&&i.hasAttribute("collapse")&&a.element(i).triggerHandler("click",c)},k=function(){var a=b.view.pick.getMultiPickEnabled();b.view.focus.focusObject({objectId:g.objectSelected,replace:!a,flyTo:a?"none":"newSelected"},function(){d.throttle=!1})},l=function(a,b){h=c.getLi(f,b),h&&(h[a?"addClass":"removeClass"]("anatomy-selected"),a&&!d.throttle&&j(h,{state:"show",animate:!1}),a||j(h,{state:"collapse",animate:!1}))};g.objectSelected?f.on("click",function(a){a.preventDefault(),d.throttle=!0,k(),j(f.parent(),{state:"show"})}):b.events.on("scene.objectsSelected",function(a){var b=a.selectedObjectsUpdate;c.updateState(b,l)})}}}]).directive("objectTree",["Human","ObjectTree",function(a,b){return{restrict:"E",templateUrl:"templates/scene/object-tree.html",scope:!0,transclude:!0,link:function(c){var d;c.objectTreeConfig={itemId:"{{ objectId }}",itemClasses:function(a){return{"anatomy-enabled":a.shown,"anatomy-selected":a.selected}}},a.events.on("started",function(){c.sceneObjects=b.build(a.scene.rootObjects),c.show=d}),c.$watch("uiComponents.config.objectTree",function(a){d=!!a})}}}]),a.module("humanUI.timeline",[]).directive("playPauseTimeline",["Human",function(b){return{restrict:"A",scope:{config:"="},link:function(c,d){var e,f,g,h=!1,i=function(){var a=j(b.timeline.time);return null!==g&&null!==b.timeline.time&&a>=g.lastTime-b.timeline.FRAME_LENGTH},j=function(a){return Math.round(1e3*a)/1e3},k=function(){var a=b.timeline.time,d=i()?g.firstTime:a;if(e||f)b.timeline.unpause();else{var h={startTime:d,loop:!1};c.config&&c.config.tour&&(h.numChapters=1),b.timeline.play(h)}};d.on("click",function(){h?b.timeline.pause():k()});var l={played:!0,playing:!0,unpaused:!0,stopped:!1,paused:!1,scrubbed:!1};a.forEach(l,function(a,c){b.events.on("timeline."+c,function(){h=a,d[h?"addClass":"removeClass"]("playing")})}),b.events.on("timeline.chapters.activated",function(a){f=!!a.loop}),b.events.on("modules.activating",function(a){var c=b.modules.modules[a.moduleId];c&&(e=!(!c.animation||!c.animation.loop))}),b.events.on("timeline.timeFrame.updated",function(a){g=a})}}}]).directive("humanPlayPause",function(){return{restrict:"E",scope:!0,templateUrl:"templates/timeline/play-pause.html",link:function(b){b.$watch("uiComponents.config.playPause",function(c){b.uiComponents.config&&(b.show=!b.uiComponents.config.scrubber&&!!c,a.isObject(c)&&(b.config=c))})}}}).directive("humanChapters",["Human","checkModule",function(a,b){return{restrict:"E",scope:{config:"="},templateUrl:"templates/timeline/chapters.html",link:function(c,d){var e;c.getOffset=function(a){return c.config.scrubber?a/e.lastTime*100+"%":"auto"};var f=function(d){d&&c.config&&c.config.chapters&&(e=a.timeline.getTimeFrame(),c.chapters=d,c.showTitles=!b("ui.bootstrap"),c.toolTipPos=c.config.scrubber?"left":"top")};d.on("click",function(b){if(/chapter/.test(b.target.className))if(c.config.scrubber)a.timeline.play({startChapterId:b.target.id,loop:!1,numChapters:1});else{var d=a.timeline.chapters[b.target.id],e=c.chapters.indexOf(d),f=e-c.curIndex;1===Math.abs(f)?a.timeline[1===f?"next":"prev"]():a.timeline.scrub({chapterId:b.target.id})}}),c.$on("human.locale",function(a,b){c.locale=b,c.$apply()}),a.events.on("timeline.chapters.updated",f),a.events.on("timeline.chapters.activated",function(a){c.curIndex=a.newChapterIndex,c.$apply()})}}}]).directive("humanScrubber",["$filter","Human",function(b,c){return{restrict:"E",scope:!0,templateUrl:"templates/timeline/scrubber.html",link:function(d,e){var f,g,h,i,j=function(){return g=b("date")(1e3*c.timeline.time,"mm:ss"),h=b("date")(1e3*f.lastTime,"mm:ss"),g+" / "+h},k=function(a){return f.firstTime+(f.lastTime-f.firstTime)*a},l=function(a){f=a,d.config.value=c.timeline.time,d.config.max=f.lastTime,c.events.on("timeline.playing",function(a){d.config.value=a.time,d.$apply()}),d.show=!0,d.$apply()};d.config={change:function(a){c.timeline.scrub({time:k(a.fraction)})},label:j},c.events.on("modules.deactivated",function(){d.show=!1,d.$apply()}),c.events.on("timeline.timeFrame.updated",function(a){i&&l(a)}),d.$watch("uiComponents.config.scrubber",function(b){i=!!b,a.isObject(b)&&(d.uiConfig=b,d.uiConfig.scrubber=!0,d.uiConfig.chapters&&e.addClass("chapters"))})}}}]).directive("prevNextChapter",["Human",function(a){return{restrict:"A",link:function(b,c,d){var e,f,g=d.prevNextChapter||"next",h=function(a){f=!!("next"===g&&a===e.length-1||"prev"===g&&0===a),c[f?"addClass":"removeClass"]("disabled")};c.on("click",function(){f||a.timeline[g]()}),a.events.on("timeline.chapters.updated",function(a){e=a}),a.events.on("timeline.chapters.activated",function(a){h(a.newChapterIndex)})}}}]).directive("humanTour",["$q","$timeout","Human",function(b,c,d){return{restrict:"E",scope:!0,templateUrl:"templates/timeline/tour.html",link:function(b,e){var f,g;d.events.on("timeline.chapters.updated",function(a){c(function(){b.show=g&&a.length>1?!0:!1,b.$apply()})}),d.events.on("modules.deactivated",function(){b.show=!1,b.$apply()}),b.$watch("uiComponents.config.tour",function(c){b.uiComponents.config&&(f=b.uiComponents.config,g=!f.scrubber&&!f.playPause&&!!c,g&&a.isObject(c)&&(b.uiConfig=c,b.uiConfig.tour=!0,b.uiConfig.chapters&&e.addClass("chapters")))})}}}]),a.module("humanUI.tree",[]).factory("Tree",["$interpolate",function(b){var c,d,e,f="<span collapse></span>";return{buildClasses:function(b,c,f){return d=[],e=f?f(b):{},a.extend({"tree-leaf":c},e),a.forEach(e,function(a,b){a&&d.push(b)}),d.join(" ")},buildDOMString:function(c,d,e){var g,h,i,j=this,k="<ul>",l=e.itemId?' id="'+e.itemId+'"':"",m="<li"+l+' class="{{ classes }}">';return a.forEach(d,function(a){g=a.objects&&a.objects.length>0,i=e.itemClasses,a.classes=j.buildClasses(a,!g,i),h=m+(g?f:"")+c,h=b(h)(a),g&&(h+=j.buildDOMString(c,a.objects,e)),k+="</li>"+h}),k+="</ul>"},getLi:function(b,d){c=b.find("li");for(var e=0;e<c.length;e++)if(c[e].id===d)return a.element(c[e])},updateState:function(b,c){a.forEach(b,c)}}}]).directive("collapse",["$timeout",function(b){return{restrict:"A",link:function(c,d){var e,f,g,h=d.parent(),i=h.children(),j=a.element(i[i.length-1]),k=!1,l=!0;j.css("height","0px"),h.addClass("collapsed"),d.on("click",function(a,c){a.stopPropagation(),c||(c={}),f=!("show"!==c.state||l),g=!("collapse"!==c.state||!l),k||!j||f||g||(k=!0,c.animate!==!1&&j.addClass("animating"),j.css("height",j[0].scrollHeight+"px"),h[l?"removeClass":"addClass"]("collapsed"),l||(e=j[0].offsetHeight,j.css("height","0px")),b(function(){l=!l,k=!1,l||j.css("height","auto"),j.removeClass("animating")},350))})}}}]).directive("humanTree",["$compile","Tree",function(b,c){return{restrict:"E",scope:{treeData:"=",treeConfig:"="},compile:function(d,e){var f=e.$$element,g=f[0].innerHTML;a.element(f).empty();var h=function(a,d){a.$watch("treeData",function(e){if(e){var f=a.treeConfig||{};d.append(c.buildDOMString(g,e,f)),b(d.contents())(a)}})};return h}}}]),a.module("humanUI.templates",["templates/annotations/panel.html","templates/camera/pan.html","templates/camera/zoom.html","templates/cross-section/panel.html","templates/cross-section/slider.html","templates/dissect/panel.html","templates/info/panel.html","templates/load/progress.html","templates/media/audio.html","templates/modes/isolate.html","templates/modes/xray.html","templates/scene/object-tree.html","templates/timeline/chapters.html","templates/timeline/play-pause.html","templates/timeline/scrubber.html","templates/timeline/tour.html","templates/ui/slider.html"]),a.module("templates/annotations/panel.html",[]).run(["$templateCache",function(a){a.put("templates/annotations/panel.html",'<button\n  class="tool annotations"\n  toggle-button="toggleAnnotations"\n  tooltip="Toggle Annotations"></button>')}]),a.module("templates/camera/pan.html",[]).run(["$templateCache",function(a){a.put("templates/camera/pan.html",'<div pan-camera="up" title="Pan Up [{{ keys.up }}]"></div>\n<div pan-camera="right" title="Pan Right [{{ keys.right }}]"></div>\n<div pan-camera="down" title="Pan Down [{{ keys.down }}]"></div>\n<div pan-camera="left" title="Pan Left [{{ keys.left }}]"></div>\n\n<div center-camera title="Center"></div>')}]),a.module("templates/camera/zoom.html",[]).run(["$templateCache",function(a){a.put("templates/camera/zoom.html",'<div zoom-camera="out">-</div>\n<div zoom-camera="in">+</div>')}]),a.module("templates/cross-section/panel.html",[]).run(["$templateCache",function(a){a.put("templates/cross-section/panel.html",'<button\n  class="cross-section tool"\n  toggle-button="callbacks"\n  tooltip-append-to-body="true"\n  tooltip="Cross Section"></button>\n\n<div class="controls" ng-show="showControls">\n  <button\n    class="tool"\n    cycle-section-plane plane="curPlane"\n    tooltip="Select Plane"></button>\n\n  <human-cross-section-slider></human-cross-section-slider>\n  <span class="view">{{ curPlane.view }}</span>\n\n  <button\n    class="tool"\n    reset-section-plane\n    plane="curPlane"\n    tooltip="Reset"></button>\n</div>')}]),a.module("templates/cross-section/slider.html",[]).run(["$templateCache",function(a){a.put("templates/cross-section/slider.html",'<human-slider config="config"></human-slider>')}]),a.module("templates/dissect/panel.html",[]).run(["$templateCache",function(a){a.put("templates/dissect/panel.html",'<button\n  class="tool dissect"\n  toggle-button="toggleDissect"\n  toggle-model="shown"\n  tooltip="Dissect [Ctrl + X]"></button>\n\n<button\n  class="tool dissect-undo"\n  undo-dissect\n  tooltip="Undo Dissect [Ctrl + Z]"></button>')}]),a.module("templates/info/panel.html",[]).run(["$templateCache",function(a){a.put("templates/info/panel.html",'<h1 class="title">{{ infoTitle }}</h1>\n<div class="description" ng-bind-html="infoDescription | parseActions"></div>\n<ng-transclude class="custom-content"></ng-transclude>')}]),a.module("templates/load/progress.html",[]).run(["$templateCache",function(a){a.put("templates/load/progress.html",'<div class="progress-indicator">\n  <span ng-show="showProgress(curProcess.progress)">{{ curProcess.progress | progressPercent }}</span>\n</div>\n\n<div class="status-text">\n  <span>{{ initialized ? curProcess.statusText : initialStatusText }}</span>\n</div>')}]),a.module("templates/media/audio.html",[]).run(["$templateCache",function(a){a.put("templates/media/audio.html",'<audio autoplay></audio>\n<button mute-replay-audio class="tool"></button>')}]),a.module("templates/modes/isolate.html",[]).run(["$templateCache",function(a){a.put("templates/modes/isolate.html",'<button\n  class="tool isolate"\n  toggle-button="toggleIsolate"\n  tooltip="Isolate Mode [I]"></button>')}]),a.module("templates/modes/xray.html",[]).run(["$templateCache",function(a){a.put("templates/modes/xray.html",'<button\n  class="tool xray"\n  toggle-button="toggleXray"\n  tooltip="Transparency Mode [T]"></button>')}]),a.module("templates/scene/object-tree.html",[]).run(["$templateCache",function(a){a.put("templates/scene/object-tree.html",'<ng-transclude></ng-transclude>\n<human-tree\n  tree-data="sceneObjects"\n  tree-config="objectTreeConfig"\n  object-selected\n  object-enabled>\n    <a\n      object-selected="{{ objectId }}"\n      title="{{ displayName }}"\n      class="tree-item">\n      <span\n        object-enabled="{{ objectId }}"\n        class="anatomy-check-icon"></span>{{ displayName }}\n    </a>\n</human-tree>')}]),a.module("templates/timeline/chapters.html",[]).run(["$templateCache",function(a){a.put("templates/timeline/chapters.html",'<button\n  ng-repeat="chapter in chapters"\n  id="{{ chapter.chapterId }}"\n  class="chapter"\n  ng-class="{ on: $index === curIndex}"\n  tooltip="{{ chapter | translate:\'displayName\':locale }}"\n  tooltip-placement="{{ toolTipPos }}"\n  title="{{ showTitles && chapter | translate:\'displayName\':locale }}"\n  ng-style="{ left: getOffset(chapter.time) }">{{ $index + 1 }}</button>')}]),a.module("templates/timeline/play-pause.html",[]).run(["$templateCache",function(a){a.put("templates/timeline/play-pause.html",'<button play-pause-timeline config="config"></button>')}]),a.module("templates/timeline/scrubber.html",[]).run(["$templateCache",function(a){a.put("templates/timeline/scrubber.html",'<button play-pause-timeline config="uiConfig"></button>\n\n<human-chapters config="uiConfig"></human-chapters>\n<human-slider config="config"></human-slider>')}]),a.module("templates/timeline/tour.html",[]).run(["$templateCache",function(a){a.put("templates/timeline/tour.html",'<div>\n  <button prev-next-chapter="prev"></button><human-chapters config="uiConfig"></human-chapters><button prev-next-chapter="next"></button>\n</div>')}]),a.module("templates/ui/slider.html",[]).run(["$templateCache",function(a){a.put("templates/ui/slider.html",'<div class="track">\n  <div class="progress"></div>\n  <div class="handle"\n    ng-mouseover="showLabel = !!config.label"\n    ng-mouseleave="showLabel = false">\n    <div class="progress-label" ng-show="showLabel">{{ label }}</div>\n  </div>\n</div>')}])}(angular);