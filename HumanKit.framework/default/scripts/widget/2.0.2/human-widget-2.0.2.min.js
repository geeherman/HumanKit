!function(a,b){"use strict";!function(a,b){b.module("humanScene",["humanScene.content","humanScene.bookmark","humanScene.module","humanScene.chapter"]).filter("anatomySearch",function(){return function(a,b){var c={};if(a.length)for(var d=0;d<a.length;d++)if(a[d].groups.length){c.id=a[d].id;var e=[b,a[d].groups[0].replace(/\s/g,"_")].join("-");/system$/i.test(e)||(e+="_System"),/ligaments/i.test(e)&&(e=e.replace(/ligaments/i,"Ligament"),c.id=e),c.system=e;break}return c}}).factory("HumanScene",["$q","$timeout","ContentManager","ModuleManager",function(a,c,d,e){var f={setContent:d.setContent,finish:b.noop,onError:b.noop},g=function(a,b,c){var d=Human.scene.getObject(a);if(b=parseInt(b),c=c||100,!isNaN(b)){b=Math.min(b,c);for(var e=0;d.parent&&b>e;e++)d=d.parent}return d.objectId},h=function(c){var d=a.defer(),e=null;if(b.isString(c)){var f=c.split(",");b.isArray(f)&&6===f.length&&(e={eye:{x:f[0],y:f[1],z:f[2]},look:{x:f[3],y:f[4],z:f[5]}})}else c.selectedObject?e={selectedLeafObjects:!0}:c.primaryBase&&!c.bookmark&&(e={enabledObjects:!0});return b.isObject(e)?Human.view.camera.fly.flyTo(e,d.resolve):d.resolve(),d.promise};return{config:function(a){b.extend(f,a)},load:function(){var d=this,g=Array.prototype.slice.call(arguments,0),h=b.isFunction(f.setContent)?f.setContent.apply(d,g):f.setContent,i=function(a){a.id&&(b.isObject(a.baseAnatomyObjects)||(a.baseAnatomyObjects={}),e.load(a.id,a.baseAnatomyObjects,!!a.bookmark).then(function(){return c(d.stage.bind(d,a))}).then(function(){f.finish.apply(d,g)}))};a.when(h).then(i,f.onError)},stage:function(b){var c=a.defer(),d=function(){var a=b.camera||{primaryBase:!!e.primaryBase,bookmark:!!b.bookmark,selectedObject:!!b.selectedObject};h(a),c.resolve()};if(b.selectedObject){Human.view.xray.setEnabled(!0);var f=b.generations,i=f?g(b.selectedObject,f):b.selectedObject;Human.scene.setSelectedObjects({objectId:i,select:!0}),d()}else b.bookmark?Human.bookmarks.restore(b.bookmark,d,!0):d();return c.promise}}}]).factory("humanScene",["HumanScene",function(a){return a}]),b.module("humanScene.bookmark",[]).factory("BookmarkManager",["$filter","BASE_ANATOMY_TEMPLATE","ModuleManager",function(a,c,d){var e=function(a){var b={};for(var c in a)if(a.hasOwnProperty(c)&&(/^femaleAdult/.test(c)&&(b.female=!0),/^maleAdult/.test(c)&&(b.male=!0),b.male&&b.female))break;return b},f=function(a){var c={},d=function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&/^(fe)?maleAdult/.test(c)&&(a[c].selected||a[c].enabled)&&(b[c]=!0);return b};return b.isArray(a)?b.forEach(a,function(a){b.extend(c,d(a.objects))}):c=d(a),c},g=function(a,b){var c,e,f=a.modules.activeModules||[];if(f.length){for(var g=0;g<f.length;g++)if(c=d.getBase(f[g])){e=g;break}f.length>1&&0!==e&&f.unshift(f.splice(e,1)[0])}var h=Object.keys(b).length>0;!h&&c&&f.length>0&&(c=null,f.shift()),a.modules.moduleLibs&&(a.modules.moduleLibs=[])};return{normalizeLegacy:function(a){a.modules={},a.modules.activeModules=[],a.modules.moduleLibs=[],b.isObject(a.objects)||(a.objects={});var c=d.getGenderModule(a.objects);c&&a.modules.activeModules.unshift(c)},normalizeTour:function(a,d){var f=e(d),h=!(!f.male||!f.female),i=Object.keys(d).length>0;b.forEach(a,function(a){if(g(a,d),!h&&i){var b=f.female?"female":"male",e=a.modules.activeModules,j=c.replace(/\{0\}/g,b);0!==e.indexOf(j)&&e.unshift(j)}})},normalize:function(a){var c=a.bookmark||null,d=null,e=null;if(c){b.isObject(c.modules)||this.normalizeLegacy(c);var h=b.isArray(c.tour)&&c.tour.length>0;if(h){var i=[c].concat(c.tour);d=f(i),this.normalizeTour(i,d)}else d=f(c.objects),g(c,d);var j=c.modules.activeModules[0],k=/(\w+)Adult/,l=j.match(k);b.isArray(l)&&l[1]&&(e=l[1])}return{bookmark:c,streamObjects:d,gender:e}}}}]),b.module("humanScene.chapter",[]).factory("ChapterManager",function(){var a={},c=function(a){for(var b in a)a.hasOwnProperty(b)&&/^(fe)?maleAdult/.test(b)&&delete a[b]},d=function(a){var c=null,d=b.isObject(a),e=d&&b.isObject(a.scrub);if(e){var f=a.scrub;0===f.time?c=Human.timeline.chapterList[0]:f.hasOwnProperty("chapterId")&&(c=Human.timeline.chapters[f.chapterId])}return c},e=function(e){a.firstChapter.showObjects=a._showObjects,a.firstChapter.selectObjects=a._selectObjects;var f=d(e.timeline);f&&(c(f.showObjects),b.extend(f.showObjects,a.baseAnatomyObjects),b.isObject(e.camera)&&b.forEach(["flyTo","jumpTo"],function(a){f.hasOwnProperty(a)&&(f[a]=e.camera)}))},f=function(b){if(b.length>0){var c=a.firstChapter=b[0];a._showObjects=c.showObjects,a._selectObjects=c.selectObjects,c.showObjects={},c.selectObjects={},Human.events.once("bookmarks.restored",e)}};return{check:function(b){a={baseAnatomyObjects:b},Human.events.off("timeline.chapters.updated",f),Human.events.on("timeline.chapters.updated",f)}}}),b.module("humanScene.content",[]).constant("BASE_CONTENT_CONFIG",{id:null,gender:null,baseAnatomyObjects:{},bookmark:null,camera:null,selectedObject:null,generations:null}).provider("ContentManager",["BASE_CONTENT_CONFIG",function(a){var c=["a","b","be","m","o"],d="male",e="production/{0}Adult",f={moduleDir:e,gender:d},g=function(a,b,c){return c||(c=f.moduleDir),c=c.replace("{0}",b||f.gender),[c,a+".json"].join("/")},h=["$q","$http","$filter","BookmarkManager"],i=function(d,h,i,j){var k=function(a,b){var c=a.indexOf("/")>=0;return{id:c?a:g(a,b)}},l=function(a,c){c=c||f.gender;var d=a.split(","),h=c+"Adult",i={};return b.forEach(d,function(a){var b=a.indexOf("-")>=0?a:[h,a].join("-");i[b]=!0}),{id:g(h,c,e),baseAnatomyObjects:i}},m=function(a,b,c){c=c||f.gender;for(var j=d.defer(),k=a.split("-"),l=[],m=c+"Adult",n={},o=0;o<k.length;o++)k[o].length>2&&l.push(k[o]);var p=[m,"Integumentary_System"].join("-");n[p]=!0;var q="/search/anatomy?q="+c+"+"+l.join("+");return h.get(q).success(function(a){var d=i("anatomySearch")(a.results,m);n[d.system]=!0,j.resolve({id:g(m,c,e),baseAnatomyObjects:n,selectedObject:d.id,generations:b||null})}).error(function(){j.reject("Error searching anatomy")}),j.promise},n=function(a,b){var c=d.defer(),e="/search/bookmarks/data?"+b+"="+a;return h.get(e).success(function(a){if(a=j.normalize(a),a.bookmark){var b=a.bookmark.modules.activeModules;c.resolve({id:b[b.length-1],gender:a.gender,baseAnatomyObjects:a.streamObjects,bookmark:a.bookmark})}else c.reject("Bookmark was empty.")}).error(function(){c.reject("Bookmark does not exist")}),c.promise};return{setModule:k,setAnatomy:l,setPrettyAnatomy:m,setBookmark:n,setContent:function(){var e,f=d.defer(),g=Human.request.getSearchParams(),h=b.copy(a),i=function(a,c){a.apply(null,c).then(function(a){f.resolve(b.extend(h,a))},f.reject.bind(f))};if(g.s&&(h.gender=g.s),g.camera&&(h.camera=g.camera),g.m||g.o)g.o&&b.extend(h,l(g.o,h.gender)),g.m&&b.extend(h,k(g.m,h.gender)),f.resolve(h);else if(g.a)e=[g.a,g.parent,h.gender],i(m,e);else if(g.b||g.be){var j=g.b?"b":"be";e=[g[j],j],i(n,e)}else{var o="URL param required: '{0}'";o=o.replace("{0}",c.join("|")),f.reject(o)}return f.promise}}};return h.push(i),{$get:h,config:function(a){b.extend(f,a)}}}]),b.module("humanScene.module",[]).constant("BASE_ANATOMY_TEMPLATE","production/{0}Adult/{0}Adult.json").factory("ModuleManager",["$q","$timeout","ChapterManager",function(a,c,d){var e={onError:b.noop},f=function(){var b=a.defer();return b.resolve(null),b.promise},g=function(a,b){var c={},d=!b;for(var e in a)a.hasOwnProperty(e)&&/^(fe)?maleAdult/.test(e)===d&&(c[e]=a[e]);return c},h=function(b){var c=a.defer(),d=["embedded",b].join("_");return Human.modules.db.loadModuleDefinitions(d,[b],function(){var a=Human.modules.modules[b];a?c.resolve(a):e.onError()}),c.promise},i=function(b){var d=a.defer(),e=Human.net.mode,f=function(a,b){k(a)&&"stream"!==e&&Human.net.setMode(b)},g=function(){if(b.length){var a=b.shift();f(a,"stream"),Human.modules.activateModules({moduleId:a},function(){f(a,e),g()})}else d.resolve()};return c(g),d.promise},j=function(a){var c=a.ui,d=a.tags,e=d.indexOf("tour")>=0;return b.isObject(c)&&!!c.tour||e},k=function(a){var b=a.match(/((?:fe)?maleAdult)\.json$/);return!!b&&b[1]||null},l=function(a){var b,c=null;for(var d in a)if(a.hasOwnProperty(d)&&(b=d.match(/^(fe)?maleAdult/))){c=["production",b[0],b[0]+".json"].join("/");break}return c};return{config:function(a){b.extend(e,a)},getBase:k,getGenderModule:l,load:function(c,e,m){var n,o,p,q,r=a.defer(),s=this.primaryBase=!!k(c),t=Object.keys(e).length>0,u={};return h(c).then(function(a){n=a,s&&(o=n),m?(d.check(e),j(n)&&(u=n.showObjects),n.showObjects={},n.selectObjects={}):t&&b.extend(n.showObjects,e),q=m?e:n.showObjects,q=g(q);var c=s?null:l(q),i=c?h(c):f();return i}).then(function(a){if(p=[n.moduleId],a&&(o=a,a.showObjects={},p.unshift(a.moduleId)),o){var c;c=s?t?e:{}:b.extend(u,q),o.streamObjects=c}i(p).then(r.resolve)}),r.promise}}}]).factory("moduleManager",["ModuleManager",function(a){return a}])}(a,b),b.module("humanWidget",["ngTouch","oc.lazyLoad","humanWidget.webglTest","humanWidget.pass","humanWidget.fail","humanWidget.files","humanWidget.scene","humanWidget.user","humanWidget.backgroundColor","humanWidget.backgroundImage"]).constant("EMBEDDED",a.top!==a).factory("widgetParams",["$window","dashNormalizeFilter",function(a,b){var c={},d=/[?&]+([^=&]+)=([^&]*)/gi;return a.location.href.replace(d,function(d,e,f){c[b(e)]=a.decodeURIComponent(f)}),c}]).run(["$rootScope","humanTest",function(a,b){b.run().then(function(b){a.$broadcast("human.result",b)})}]).filter("versionObject",["$window",function(a){var c=["major","minor","patch"];return function(d){var e=d.split("."),f={};return 1===e.length&&(f.custom=!0,f.name=e[0]),b.forEach(c,function(b,c){f[b]=f.custom?null:a.parseInt(e[c],10),"patch"===b&&e[c]&&2===e[c].split("-").length&&(f.custom=!0)}),f.compareTo=function(a,b,c){return"master"===f.name||"qa"===f.name?1:f.major>a?1:f.major<a?-1:f.minor>b?1:f.minor<b?-1:f.patch>c?1:f.patch<c?-1:0},f}}]).filter("dashNormalize",function(){return function(a){return/^[a-z]+([_[A-Z])[a-z]+/.test(a)?a.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/([a-zA-Z])_/g,"$1-").toLowerCase():a}}).directive("addThisPanel",["$document","widgetParams",function(a,b){var c="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-550aea82137ea04d";return{template:'      <div class="addthis_sharing_toolbox"></div>    ',link:function(){if("true"===b["ui-share"]){var d=a[0].createElement("script");d.async=1,d.src=c,a[0].body.appendChild(d)}}}}]).directive("moduleError",function(){return{restrict:"E",template:'<div class="logo-image"></div><p>Sorry, it looks like the module you\'re looking for was not found.</p>',scope:!0,link:function(a){var b=function(){Human.events.on("net.error",function(){a.show=!0,a.$apply()})};a.$on("human.loaded",b)}}}).controller("MainController",["$scope","EMBEDDED","widgetParams",function(a,b,c){a.widgetParams=c,a.backgroundImage={},a.$on("human.result",function(c,d){a.embedded=b,a.pass=d.pass,a.result=d.fullResult}),a.$on("human.moduleData",function(b,c){a.moduleData=c}),a.$on("human.fallbackTour",function(b,c){a.fallbackTour=c,a.noFallbackTour=!c}),a.$on("backgroundImage.show",function(){a.backgroundImage.show=!0}),a.$on("backgroundImage.remove",function(){a.backgroundImage.remove=!0}),a.$on("backgroundImage.image",function(b,c){a.backgroundImage.load=!!c,a.backgroundImage.image=c||null})}]),b.module("humanWidget.backgroundColor",[]).constant("STANDARD_BG","0.13, 0.15, 0.17, 0.54, 0.58, 0.64").run(["BackgroundColor",function(a){a.init()}]).provider("BackgroundColor",["STANDARD_BG",function(a){var c={gradient:"radial"},d=function(a){b.extend(c,a)},e=["$document","widgetParams",function(b,d){return{_is256Scale:function(a){for(var b=0;b<a.length;b++)if(parseFloat(a[b])>1)return!0;return!1},_cssRGB:function(a,b){b="boolean"==typeof b?b:!0;for(var c=[],d=0;d<a.length;d++)c.push(Math.round(a[d]*(b?255:1)));return"rgb("+c.join(",")+")"},_getGradient:function(a){var b=[],c=a.split(","),d=!this._is256Scale(c),e=c.length>12?c.length-1:c.length;b[0]=c.slice(0,3),b[1]=c.slice(e-3,e);for(var f=0;f<b.length;f++)b[f]=this._cssRGB(b[f],d);return b},get:function(){return this._bgColor},getCSS:function(){return this._css},set:function(b){if("string"==typeof b){var d=[];this._bgColor=b;var e=b.match(/([\d\.]+,){2,15}[\d\.]+/);e?(this._bgColor="custom",d=this._getGradient(e[0])):"standard"===b?d=this._getGradient(a):d[0]=d[1]=b,this._css="radial"===c.gradient?"radial-gradient(ellipse at center, "+d[1]+" 0%, "+d[0]+" 100%)":"linear-gradient(top, "+d[0]+" 0%, "+d[1]+" 100%)"}},init:function(){var a=d.bgstd;if(!a){var c=b[0].cookie.match(/background=([^;\s]*)/);a=c&&c[1]?c[1]:"standard"}this.set(a)}}}];return{config:d,$get:e}}]).directive("backgroundColor",["BackgroundColor",function(a){return{restrict:"AC",link:function(c,d,e){if(b.isDefined(e.backgroundColor))for(var f=["-webkit-","-moz-","-ms-","-o-",""],g=a.getCSS(),h=0;h<f.length;h++)d.css("background-image",f[h]+g);else if(d.hasClass("background-color")){var i=["bg",a.get()].join("-");d.addClass(i)}}}}]),b.module("humanWidget.backgroundImage",[]).constant("IMAGE_PARAMS",{large:{threshold:800,"default":{width:1200,height:800}},medium:{threshold:600,"default":{width:800,height:600}},small:{"default":{width:400,height:400}}}).constant("SCREENSHOT_SERVICE","/screenshots/img").constant("BOOKMARK_SERVICE","/thumbnails/bookmarks").run(["$rootScope","widgetParams","BackgroundImage",function(a,b,c){"fallback"===b["image-display"]?a.$on("human.result",function(a,b){b.pass||c.init()}):c.init()}]).factory("BackgroundImage",["$window","$timeout","$rootScope","widgetParams",function(a,c,d,e){return{_store:{container:null,image:null},get:function(a){return this._store[a]},set:function(a,b){this._store[a]=b,d.$broadcast(["backgroundImage",a].join("."),b)},show:function(a){d.$broadcast("backgroundImage.show",a)},hide:function(){d.$broadcast("backgroundImage.hide")},remove:function(){d.$broadcast("backgroundImage.remove")},init:function(){var a=this,f=e.s||"male",g=e.m||e.a,h=e.be||e.b,i=e["image-src"];c(function(){var j;if(g||h){if(j={s:f},g)j.src=g.replace(/\//g,"_").replace(/\.json$/,"");else{var k=e.be?"eid":"id";j[k]=h}i||(i=b.copy(j))}d.$broadcast("backgroundImage.init",{src:i,base:j}),c(function(){i?a.show(i):a.remove()})})}}}]).directive("sizeBackgroundImage",["IMAGE_PARAMS","BackgroundImage",function(a,b){return{restrict:"A",scope:!0,link:function(c){var d,e,f=function(a){if(d||e)if(c.landscape=a.width>a.height,c.portrait=a.width<a.height,c.square=a.width===a.height,"initial"===c.widgetParams["image-size"]){var b="large"===a.size&&(a.width>d[e]||a.height>d[e]);c.cover=!b}else c.cover=!0},g=function(c){if(c){var g=b.get("container"),h=a[g.size||"small"]["default"];d={width:c.width||h.width,height:c.height||h.height},e=d.width>=d.height?"width":"height",f(g)}else d=null,e=null};c.$watch("backgroundImage.image",g),c.$on("backgroundImage.container",function(a,b){f(b),c.$apply()})}}}]).directive("backgroundImage",["$document","$timeout","BackgroundImage","backgroundImageUrlFilter",function(a,b,c,d){return{restrict:"A",scope:!0,link:function(a,e){var f,g;a.show=!1;var h=function(b){var c,d,f;return b?(d="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+b.src+"', sizingMethod='scale')",c="url("+b.src+")"):c=d="none",f={"background-image":c,"-ms-filter":d,filter:d},a.hasContent=!!b,e.css(f),f},i=function(){h(null),c.set("image",{})},j=function(e){var i=$(new Image),j=!1,k=!1;a.loading=!0,i.load(function(){this.src.indexOf(f)>=0&&!k&&(k=!0,c.set("image",{css:h(this),src:this.src,width:this.width,height:this.height}),a.loading=!1,a.$apply())}),i.error(function(){this.src.indexOf(f)>=0&&(j=!0,h(null),c.set("image",null),a.show=!1,a.loading=!1,a.$apply())});var l=c.get("container").size;f=d(e,l),i[0].src=f,i[0].complete&&b(function(){k||i.trigger("load")}),g&&b.cancel(g),g=b(function(){k||j||i.trigger("load")},3e3)};a.$on("backgroundImage.show",function(b,c){j(c),a.show=!0}),a.$on("backgroundImage.hide",function(){i(),a.show=!1}),a.$on("backgroundImage.remove",function(){e.remove()})}}}]).directive("captureSize",["$window","IMAGE_PARAMS","BackgroundImage",function(a,c,d){return{restrict:"A",link:function(e,f){var g=b.element(a),h=function(){var a={width:f.outerWidth(),height:f.outerHeight()};for(var b in c)if(c.hasOwnProperty(b)){var e=c[b].threshold;if(a.width>=e||a.height>=e){a.size=b;break}}d.set("container",a)};e.$on("backgroundImage.init",h),e.$watch("backgroundImage.load",function(a){a&&(g.off("resize.backgroundImage"),g.on("resize.backgroundImage",h))}),e.$watch("backgroundImage.remove",function(a){a&&g.off("resize.backgroundImage")})}}}]).filter("backgroundImageUrl",["_conditionUrlFilter","_bookmarkUrlFilter","_customUrlFilter",function(a,b,c){return function(d,e){var f;if(d.s){var g=d.src?a:b;f=g(d,e)}else f=c(d);return f}}]).filter("_conditionUrl",["SCREENSHOT_SERVICE",function(a){return function(b,c){var d=c?"_"+c:"";return a+"/t_c_"+b.s[0]+"_"+b.src+d+".jpg"}}]).filter("_bookmarkUrl",["BOOKMARK_SERVICE",function(a){return function(b,c){var d=c?"&size="+c:"",e=b.eid?"eid":"id",f="s="+b.s+"&"+e+"="+b[e]+d;return[a,f].join("?")}}]).filter("_customUrl",["$document","SCREENSHOT_SERVICE",function(a,b){var c=function(){var b=a[0],c=b.createElement("a");return c.href=b.referrer,c.hostname}();return function(a){var d;return"!"===a[0]?(d="//"+c,a=a.slice(1)):d=b,/^(http(s)?:)?\/\//.test(a)?a:[d,a].join("/")}}]),b.module("humanWidget.fail",[]).run(["$rootScope","Module",function(a,b){var c=function(b){a.$broadcast("human.moduleData",b?b.data:null)};a.$on("human.result",function(a,d){d.pass||b.get().then(c,c.bind(null,null))})}]).factory("Module",["$http","widgetParams",function(a,b){return{get:function(){var c=b.s||"male",d=b.m||b.a,e=/\//.test(d)?d:"production/"+c+"Adult/"+d+".json";return a.get("/content/modules/"+e)}}}]).factory("cacheAssets",["backgroundImageUrlFilter","$timeout",function(a,c){return function(){var d=[],e=[],f=arguments[0],g=arguments[1];if(b.isObject(f)&&b.isDefined(g))for(var h=a(f),i=1;g>i;i++)d.push(h.replace(/(\.(\w{3}))$/,["_",".$2"].join(i)));else b.isArray(f)&&(d=f);b.forEach(d,function(a){if(b.isString(a)||b.isObject(a)&&"image"===a.type){var c=b.isString(a)?a:a.url;e.push((new Image).src=c)}}),c(function(){e=void 0})}}]).factory("FallbackVideo",["$rootScope",function(a){return{show:function(b){a.$broadcast("fallbackVideo.show",b)},hide:function(){a.$broadcast("fallbackVideo.hide")}}}]).directive("fallbackVideo",function(){return{restrict:"A",scope:!0,link:function(a,b){a.show=!1;var c,d=function(){c&&c.remove(),c=null};a.$on("fallbackVideo.show",function(e,f){d(),b.append("<iframe></iframe>"),c=b.children("iframe")[0],c.contentWindow.location.replace(f),a.show=!0}),a.$on("fallbackVideo.hide",function(){d(),a.show=!1})}}}).directive("defaultBackground",function(){return{restrict:"A",link:function(a,b){var c=function(a){return"boolean"==typeof a&&!a},d=function(){b.css({"background-image":'url("img/tiles_layer_50.jpg")',"background-size":"cover"})};a.$watch("backgroundImage.load",function(b){c(b)&&c(a.pass)&&d()}),a.$watch("pass",function(b){c(b)&&c(a.backgroundImage.load)&&d()})}}}).directive("fallbackTour",["$rootScope","BackgroundImage","FallbackVideo","cacheAssets",function(a,c,d,e){return{restrict:"E",scope:!0,template:"<fallback-tour-controls></fallback-tour-controls>",link:function(f){var g,h,i,j,k,l=function(a){a.hasOwnProperty("length")?(f.length=a.length,g&&e(g,a.length)):b.isArray(a.assets)&&(i=a.assets,f.length=i.length,e(i),f.showAsset(f.getAsset(0))),f.length>1&&(f.show=!0)};f.show=!1,f.getAsset=function(a){return k="image",i?(j=i[a],b.isObject(j)?(h=j.url,k=j.type||k):h=i[a]):(h=b.copy(g),a>0&&(h.src=[h.src,a].join("_"))),{src:h,type:k}},f.showAsset=function(a){"image"===a.type?(c.show(a.src),d.hide()):(d.show(a.src),c.hide()),f.curAsset=a},f.$on("human.moduleData",function(c,d){var e=d&&b.isObject(d.fallback);e&&l(d.fallback),a.$broadcast("human.fallbackTour",e)}),f.$on("backgroundImage.init",function(a,b){g=b.base})}}}]).directive("fallbackTourControls",function(){return{restrict:"E",template:'      <div class="arrow arrow-left"        ng-class="{ disabled: checkLimits(-1) === \'start\' }"        ng-click="step(-1)">      </div>      <div class="arrow arrow-right"        ng-class="{ disabled: checkLimits(1) === \'finish\' }"        ng-click="step(1)">      </div>    ',link:function(a){var b=0;a.checkLimits=function(c){return 0===b&&-1===c?"start":b===a.length-1&&1===c?"finish":!1},a.step=function(c){a.checkLimits(c)||(b+=c,a.showAsset(a.getAsset(b)))}}}}).directive("failModuleInfo",["$sce",function(a){return{restrict:"E",scope:!0,template:'      <button ng-show="!!description" ng-click="toggleInfo()"></button>      <h1>{{ displayName }}</h1>      <p ng-bind-html="description"></p>    ',link:function(b,c){b.toggleInfo=function(){c.toggleClass("open")},b.$watch("moduleData",function(c){c&&(b.displayName=c.displayName,b.description=a.trustAsHtml(c.description))})}}}]).directive("failMessage",function(){return{restrict:"E",scope:!0,templateUrl:"templates/fail_message.html",link:function(a){var b=function(b){if(b){var c=/android/i.test(b)?"android":"ios";a.deviceName="android"===c?"Android":b,a.deviceLink="android"===c?"https://play.google.com/store/apps/details?id=com.biodigitalhuman.humanAndroid":"https://itunes.apple.com/us/app/biodigital-human-anatomy-health/id771825569",a.imgSrc="android"===c?"Android_App_Store_Get_Badge.png":"Download_on_the_App_Store_Badge_US-UK_135x40.png"}};a.$watch("result.device",b)}}}),b.module("humanWidget.files",[]).provider("humanFiles",function(){var a,c,d,e,f={},g={min:!1,allowParams:!1},h=function(a){b.extend(g,a)},i=["DEPENDENCIES","cssPathFilter","widgetParams","versionObjectFilter",function(h,i,j,k){var l=g.allowParams&&!!j["engine-version"],m=g.min?".min":"";b.forEach(h,function(b,g){a=g.replace("human","").toLowerCase(),c=g.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),"humanEngine"===g&&l&&(b=j["engine-version"]),d=["scripts",a,b].join("/"),e={js:[d,c+"-"+b+m+".js"].join("/"),css:i({mode:m,lib:c,libPath:d,version:b})},f[a]={lib:d,files:e}});var n=l?j["engine-version"]:h.humanEngine,o=k(n),p=[];o.compareTo(5,2,0)<0&&p.push([f.engine.lib,"lib","scenejs"+m+".js"].join("/")),p.push(f.engine.files.js,"scripts/user/human-user.js",f.ui.files.js);var q=[f.engine.files.css,f.ui.files.css];return{scripts:g.humanScripts||p,styles:g.humanStyles||q}}];return{config:h,$get:i}}).filter("cssPath",["versionObjectFilter",function(a){var b,c,d,e="css/engine-default.css";return function(f){return/engine/.test(f.lib)?(d=a(f.version),b=d.custom||d.major>4||4===d.major&&(d.minor>0||d.patch>=1),c=b?[f.libPath,"css","engine.css"].join("/"):e):c=[f.libPath,"css",f.lib+"-"+f.version+f.mode+".css"].join("/"),c}}]),b.module("humanWidget.pass",[]).constant("INIT_FILE","scripts/init/init.js").run(["$rootScope","HumanBootstrap",function(a,b){a.$on("human.result",function(c,d){d.pass&&b.load().then(function(){a.$broadcast("human.ready")})})}]).factory("HumanBootstrap",["$document","$q","$rootScope","$ocLazyLoad","INIT_FILE","BackgroundImage","humanFiles","widgetParams","HumanScene",function(a,b,c,d,e,f,g,h,i){var j=b.defer(),k=function(b,c){for(var e=b.pop(),f=b.length,g=function(){d.load(e).then(function(){c()})},h=function(){0===--f&&g()},i=function(b){var c=a[0].createElement("script");c.async=!1,c.src=b,c.onload=h,a[0].head.appendChild(c)},j=0;j<b.length;j++)i(b[j])};return{init:function(){c.$broadcast("human.loaded"),"false"===h.pre&&Human.events.on("modules.activated",f.remove),Human.init.step(i.load.bind(i)),Human.init.start(e,function(){j.resolve()})},load:function(){return k(g.scripts,this.init),j.promise}}}]).controller("moduleInfoController",["$scope","$filter",function(a,b){var c=function(){a.curModule=null,a.curChapters=null,a.curChapter=null};c();var d=function(){Human.events.on("modules.activated",function(c){a.$apply(function(){a.curModule=b("excludeBaseAnatomy")(Human.modules.activeModules[c.moduleId])||null})}),Human.events.on("timeline.chapters.updated",function(b){a.$apply(function(){a.curChapters=b})}),Human.events.on("timeline.chapters.activated",function(b){a.$apply(function(){a.curChapter=a.curChapters[b.newChapterIndex]||null})}),Human.events.on("modules.deactivated",function(){a.$apply(c)})};a.toggleHide=!0,a.$on("human.loaded",d)}]).directive("uiComponent",["$compile",function(a){return{restrict:"A",link:function(b,c,d){var e=d.uiComponent||"ready";b.$on(["human",e].join("."),function(){a(c)(b)})}}}]).controller("ComponentsController",["$scope","EMBEDDED","widgetParams",function(a,c,d){a.components={};var e={"human.result":{bd:!0},"human.ready":{fs:!0,keys:!1}},f=d["ui-all"],g=function(c){b.forEach(e[c.name],function(b,c){var e,g=d["ui-"+c];e=f&&/^(true|false)$/.test(f)?"true"===f:b?"false"!==g:"true"===g,a.components[c]=e})};a.$on("human.result",g),a.$on("human.ready",g)}]).directive("linkHumanCss",["$document","humanFiles",function(a,b){return{restrict:"A",link:function(c,d){var e,f=function(b){var f=a[0].createElement("link");f.onload=function(){e-=1,0===e&&c.$broadcast("human.cssLinked")},f.href=b,f.rel="stylesheet",f.type="text/css",d.after(f)},g=function(){var a=b.styles;e=a.length;for(var c=a.length-1;c>=0;c--)f(a[c])};c.$on("human.result",function(a,b){b.pass&&g()})}}}]).directive("ieRelinkCss",["$window",function(a){return{restrict:"A",link:function(b,c){var d=function(){var a=c[0],b=a.href;a.href="",a.href=b};b.$on("human.cssLinked",function(){"ActiveXObject"in a&&d()})}}}]).directive("windowLink",["$window",function(a){return{restrict:"A",link:function(b,c){c.attr("href",a.location.href)}}}]).directive("keypressTrigger",["$rootScope",function(a){return{restrict:"A",link:function(b,c){c.on("click",function(){a.$broadcast("keypress.trigger")})}}}]).directive("keypressModal",["widgetParams",function(a){var b="true"===a["ui-keys"]||"true"===a["ui-all"];return{restrict:"E",scope:!0,templateUrl:b&&"templates/keypress_modal.html",link:b&&function(a,b){document.getElementById("keypress-frame").src="/help-keypress.html",a["in"]=!1,b.click(function(b){b.target===b.currentTarget&&(a["in"]=!1,a.$apply())}),a.$on("keypress.trigger",function(){a["in"]=!0,a.$apply()})}}}]).directive("clickContainer",["widgetParams","BackgroundImage",function(a,b){return{restrict:"E",scope:!0,template:"<button>Click to Interact</button>",link:function(c,d){var e=function(){"false"!==a.pre&&(c.show=!0,d.one("click",function(){d.remove(),b.remove()}))};c.$watch("backgroundImage.load",function(a){a&&c.pass&&e()}),c.$watch("pass",function(a){a&&c.backgroundImage.load&&e()})}}}]),b.module("humanWidget.scene",["humanScene"]).run(["widgetActivity","ModuleManager","HumanScene",function(a,b,c){b.config({onError:a.logModuleError.bind(a)}),c.config({finish:function(b){a.verify(),console.log("Battlestation fully operational."),b()},onError:function(a){console.log(a)}})}]),b.module("humanWidget.user",[]).factory("widgetActivity",["$window","$parse",function(a,c){var d=b.noop,e=function(d,e){var f=b.fromJson(d.responseText),g=f.error.code,h={401:{error:"INVALID_CLIENTID",message:(e.is_devleoper?"Client id":e.is_user_shared?"Uaid":"Client/ua id is")+" missing or invalid"},403:{error:"DOMAIN_UNREGISTERED",message:"Domain unregistered or not allowed"}},i=b.isObject(f.error)&&f.error.message||null;i=c(i)({}),b.isArray(i)&&(i=i.join(","));var j=function(b,c){var d="/widget-auth-error.html",e="error="+b+"&message="+a.encodeURIComponent(c);return[d,e].join("?")};switch(g){case 401:case 403:if(!e.fullscreen){h=h[g];var k=j(h.error,i||h.message);a.location.replace(k)}}};return{record:function(b){a.hasOwnProperty("Human_widget_activity")&&a.Human_widget_activity.record_widget_activity(b)},logError:function(a){this.record({status:"error",message:a})},logModuleError:function(){this.logError("loadScene - Human.init.step - module = undefined")},verify:function(a){var c={success:d,failure:e};this.record(b.extend(c,a||{}))}}}]),b.module("humanWidget.webglTest",[]).provider("humanTest",function(){var a={ios:!1,android:!1},c=function(b,c,d,e){return{evaluateResult:function(b){var c=function(c,d){return("true"===e["_"+c]||a[c])&&new RegExp("^"+d,"i").test(b.device)},d=c("ios","iP"),f=c("android","Android"),g=b.html5&&b.webgl&&b.human&&(!b.device||d||f);return{pass:g,fullResult:b}},getDevice:function(a){var b=["iPad","iPhone","iPod","Android"],c=a.match(new RegExp(b.join("|"),"i"));return c&&c[0]},supportsHTML5:function(){return Modernizr.applicationcache&&Modernizr.canvas&&Modernizr.hashchange&&Modernizr.postmessage},supportsWebGL:function(){for(var a='webgl experimental-webgl webkit-3d moz-webgl "moz-glweb20',b=a.split(" "),d=c[0].createElement("canvas"),e=0;e<b.length;e++)try{if(d.getContext(b[e]))return!0}catch(f){}return!1},run:function(){var a=d.defer(),c=this.supportsHTML5(),e=c&&this.supportsWebGL(),f=c&&e;return a.resolve({html5:c,webgl:e,human:f,device:this.getDevice(b.navigator.userAgent)}),a.promise.then(this.evaluateResult)}}},d=["$window","$document","$q","widgetParams",c];return{$get:d,config:function(c){b.extend(a,c)}}}),b.module("humanWidget.templates",["templates/fail_message.html","templates/keypress_modal.html"]),b.module("templates/fail_message.html",[]).run(["$templateCache",function(a){a.put("templates/fail_message.html",'<a ng-if="!!result.device" href="{{ deviceLink }}">\n  <p>Now freely available on {{ deviceName }}</p>\n  <img ng-src="{{ \'/img/\' + imgSrc }}">\n</a>\n\n<div ng-if="!result.device">\n  <div class="logo-image"></div>\n  <p class="error-generic">Sorry, it looks like your browser does not currently support the Human. Give us a try on Chrome or Firefox for your desktop.</p>\n  <div class="error-details" ng-show="!!result">\n      <h5><b>Details</b></h5>\n      <p id="support-webgl"><b>WebGL: {{ result.webgl }}</b><span></span></p>\n      <p id="support-html5"><b>HTML5: {{ result.html5 }}</b><span></span></p>\n      <p id="support-human"><b>Human: {{ result.human }}</b><span></span></p>\n  </div>\n</div>')}]),b.module("templates/keypress_modal.html",[]).run(["$templateCache",function(a){a.put("templates/keypress_modal.html",'<div class="content">\n  <div class="header">\n   <h1>Human Keypresses</h1>\n     <button>\n       <img\n         src="img/shim.gif"\n         alt="Close"\n         title="Close"\n         class="icon-close"\n         ng-click="in = false">\n     </button>\n  </div>\n  <iframe\n   id="keypress-frame"\n   class="modal-frame normal-scroll"\n   frameborder="0"\n   scrolling="auto">\n  </iframe>\n</div>')}])}(window,angular);